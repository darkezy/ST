<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<meta name="theme-color" content="#0f0f1a"/>
<title>Ù…ØªØ¬Ø± Ø£ÙŠÙˆÙ†</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap');

:root {
  --bg:#0f0f1a; --card:#1a1a2e; --border:rgba(255,255,255,0.07);
  --accent:#40E0D0; --accent2:#20B2AA; --text:#e8e8f0; --dim:#7a7a95;
  --danger:#ff4d6d; --gold:#f5c518; --success:#00e676;
  --r:18px; --rs:12px;
  --safe-top:env(safe-area-inset-top,0px); --safe-bot:env(safe-area-inset-bottom,0px);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none;}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:'Cairo',sans-serif;overflow-x:hidden;-webkit-font-smoothing:antialiased;}
body{min-height:100%;padding-top:var(--safe-top);}

/* ===== PAGES ===== */
.page{display:none;min-height:100%;padding-bottom:calc(70px + var(--safe-bot));}
.page.active{display:block;}
#adminPage{padding-bottom:calc(60px + var(--safe-bot));}

/* ===== HEADER ===== */
.header{position:sticky;top:0;z-index:100;background:rgba(15,15,26,0.88);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:12px 18px 10px;}
.header-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.store-title{font-size:21px;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.header-actions{display:flex;gap:8px;}
.icon-btn{position:relative;background:var(--card);border:1px solid var(--border);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s;}
.icon-btn:active{transform:scale(.9);}
.icon-btn svg{width:18px;height:18px;stroke:var(--text);fill:none;stroke-width:2;}
.badge{position:absolute;top:-3px;right:-3px;background:var(--danger);color:#fff;font-size:10px;font-weight:700;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid var(--bg);opacity:0;transform:scale(0);transition:.25s;}
.badge.on{opacity:1;transform:scale(1);}

/* Currency Selector */
.currency-selector{position:relative;}
.currency-btn{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:6px 12px;font-size:12px;font-weight:600;color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:4px;transition:all .2s;}
.currency-btn:active{transform:scale(.94);}
.currency-menu{position:absolute;top:42px;right:0;background:var(--card);border:1px solid var(--border);border-radius:var(--rs);padding:6px;min-width:140px;display:none;z-index:1000;box-shadow:0 8px 24px rgba(0,0,0,.3);}
.currency-menu.show{display:block;}
.currency-opt{padding:8px 12px;border-radius:8px;cursor:pointer;font-size:12px;color:var(--text);transition:background .15s;}
.currency-opt:hover{background:rgba(64,224,208,.1);}
.currency-opt.active{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;}

/* ===== SEARCH ===== */
.search-wrap{position:relative;}
.search-wrap svg{position:absolute;left:13px;top:50%;transform:translateY(-50%);width:17px;height:17px;stroke:var(--dim);fill:none;stroke-width:2;pointer-events:none;}
.search-input{width:100%;padding:10px 14px 10px 38px;background:var(--card);border:1px solid var(--border);border-radius:var(--rs);color:var(--text);font-family:inherit;font-size:13.5px;outline:none;transition:border-color .25s;}
.search-input::placeholder{color:var(--dim);}
.search-input:focus{border-color:var(--accent);}

/* ===== CATEGORIES ===== */
.cats{display:flex;gap:7px;padding:12px 18px 4px;overflow-x:auto;scrollbar-width:none;}
.cats::-webkit-scrollbar{display:none;}
.cat{flex-shrink:0;padding:6px 16px;border-radius:30px;border:1px solid var(--border);background:var(--card);color:var(--dim);font-size:12.5px;font-weight:600;cursor:pointer;transition:.25s;white-space:nowrap;}
.cat:active{transform:scale(.94);}
.cat.on{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border-color:transparent;box-shadow:0 4px 16px rgba(64,224,208,.3);}

/* ===== BANNER ===== */
.banner{margin:10px 18px 6px;border-radius:var(--r);overflow:hidden;position:relative;height:150px;background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);border:1px solid var(--border);}
.banner .shapes{position:absolute;inset:0;overflow:hidden;}
.banner .sh{position:absolute;border-radius:50%;filter:blur(38px);opacity:.35;}
.banner .sh1{width:170px;height:170px;background:var(--accent);top:-55px;right:-35px;}
.banner .sh2{width:130px;height:130px;background:var(--accent2);bottom:-45px;left:-25px;}
.banner-c{position:relative;z-index:2;padding:24px 20px;height:100%;display:flex;flex-direction:column;justify-content:center;}
.banner-tag{display:inline-block;background:rgba(64,224,208,.15);color:var(--accent);font-size:10.5px;font-weight:700;padding:3px 9px;border-radius:18px;width:fit-content;margin-bottom:7px;}
.banner-t{font-size:19px;font-weight:800;color:#fff;line-height:1.3;}
.banner-s{font-size:12px;color:var(--dim);margin-top:3px;}

/* ===== SECTION LABEL ===== */
.sec-label{padding:16px 18px 6px;font-size:16px;font-weight:700;}

/* ===== PRODUCTS GRID ===== */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:11px;padding:0 18px 10px;}
.pcard{background:var(--card);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;cursor:pointer;transition:transform .2s,border-color .25s;position:relative;}
.pcard:active{transform:scale(.96);}
.pcard:hover{border-color:rgba(64,224,208,.3);}
.pimg{position:relative;aspect-ratio:1;background:linear-gradient(135deg,#1e1e35,#252545);display:flex;align-items:center;justify-content:center;overflow:hidden;}
.pimg .ic{font-size:36px;transition:transform .3s;}
.pcard:hover .ic{transform:scale(1.07);}
.pimg img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
.disc-badge{position:absolute;top:7px;left:7px;background:var(--danger);color:#fff;font-size:10px;font-weight:700;padding:2px 7px;border-radius:7px;}
.fav{position:absolute;top:7px;right:7px;width:28px;height:28px;border-radius:50%;background:rgba(15,15,26,.7);border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s;}
.fav:active{transform:scale(.88);}
.fav svg{width:14px;height:14px;stroke:var(--dim);fill:none;stroke-width:2;transition:.25s;}
.fav.on svg{stroke:var(--danger);fill:var(--danger);}
.pinfo{padding:9px 11px 11px;}
.pname{font-size:12.5px;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:3px;}
.prat{display:flex;align-items:center;gap:3px;margin-bottom:5px;}
.stars{color:var(--gold);font-size:10.5px;}
.rnum{font-size:10.5px;color:var(--dim);}
.prow{display:flex;align-items:center;justify-content:space-between;}
.pgrp{display:flex;align-items:center;gap:5px;}
.price{font-size:15px;font-weight:800;color:var(--accent);}
.price-old{font-size:10.5px;color:var(--dim);text-decoration:line-through;}
.add-btn{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s;box-shadow:0 3px 10px rgba(64,224,208,.35);}
.add-btn:active{transform:scale(.88);}
.add-btn svg{width:15px;height:15px;stroke:#fff;fill:none;stroke-width:2.5;}

/* ===== BOTTOM NAV ===== */
.bnav{position:fixed;bottom:0;left:0;right:0;height:calc(62px + var(--safe-bot));background:rgba(15,15,26,.92);backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);border-top:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-around;padding-top:9px;z-index:100;}
.ni{display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer;background:none;border:none;color:var(--dim);font-family:inherit;font-size:9.5px;font-weight:600;transition:color .2s;}
.ni svg{width:21px;height:21px;stroke:currentColor;fill:none;stroke-width:2;transition:transform .2s;}
.ni:active svg{transform:scale(.88);}
.ni.on{color:var(--accent);}

/* ===== SHEETS (CART / DETAIL / CHECKOUT / ADMIN) ===== */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:200;opacity:0;pointer-events:none;transition:opacity .3s;}
.overlay.on{opacity:1;pointer-events:auto;}
.sheet{position:fixed;bottom:0;left:0;right:0;background:var(--bg);border-radius:22px 22px 0 0;border-top:1px solid var(--border);z-index:201;transform:translateY(100%);transition:transform .35s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;}
.sheet.on{transform:translateY(0);}
.sheet-handle{width:38px;height:4px;background:var(--border);border-radius:2px;margin:9px auto 0;}
.sheet-head{display:flex;align-items:center;justify-content:space-between;padding:14px 18px 10px;border-bottom:1px solid var(--border);}
.sheet-head h3{font-size:17px;font-weight:700;}
.close-btn{background:var(--card);border:1px solid var(--border);border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
.close-btn svg{width:15px;height:15px;stroke:var(--text);fill:none;stroke-width:2.5;}

/* CART */
#cartSheet{height:72vh;}
.cart-items{flex:1;overflow-y:auto;padding:10px 18px;-webkit-overflow-scrolling:touch;}
.citem{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);}
.citem-ic{width:44px;height:44px;background:linear-gradient(135deg,#1e1e35,#252545);border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;overflow:hidden;}
.citem-ic img{width:100%;height:100%;object-fit:cover;}
.citem-d{flex:1;min-width:0;}
.citem-n{font-size:12.5px;font-weight:600;color:var(--text);}
.citem-p{font-size:12.5px;color:var(--accent);font-weight:700;margin-top:1px;}
.qty{display:flex;align-items:center;gap:6px;}
.qty-b{width:24px;height:24px;border-radius:7px;background:var(--card);border:1px solid var(--border);color:var(--text);font-size:15px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background .15s;}
.qty-b:active{background:#2a2a45;}
.qty-n{font-size:13px;font-weight:700;min-width:16px;text-align:center;}
.cart-empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--dim);gap:10px;padding:40px 20px;}
.cart-empty svg{width:50px;height:50px;stroke:var(--dim);fill:none;stroke-width:1.5;opacity:.5;}
.cart-empty p{font-size:14px;font-weight:600;}
.cart-empty span{font-size:12.5px;}
.sheet-foot{padding:12px 18px;border-top:1px solid var(--border);}
.total-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.total-l{font-size:13px;color:var(--dim);}
.total-v{font-size:19px;font-weight:800;color:var(--accent);}
.grd-btn{width:100%;padding:13px;border-radius:15px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:#fff;font-family:inherit;font-size:15px;font-weight:700;cursor:pointer;transition:transform .2s;box-shadow:0 5px 20px rgba(64,224,208,.3);}
.grd-btn:active{transform:scale(.96);}
.grd-btn:disabled{opacity:.4;pointer-events:none;}

/* DETAIL */
#detailSheet{height:78vh;}
.det-img{position:relative;aspect-ratio:16/9;background:linear-gradient(135deg,#1e1e35,#252545);display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden;}
.det-img-scroll{position:absolute;inset:0;display:flex;overflow-x:auto;scroll-snap-type:x mandatory;scrollbar-width:none;-webkit-overflow-scrolling:touch;}
.det-img-scroll::-webkit-scrollbar{display:none;}
.det-img-slide{min-width:100%;height:100%;scroll-snap-align:start;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.det-img-slide img{width:100%;height:100%;object-fit:cover;}
.det-img-slide .ic{font-size:64px;}
.det-close{position:absolute;top:12px;right:12px;width:32px;height:32px;border-radius:50%;background:rgba(15,15,26,.7);border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;}
.det-close svg{width:17px;height:17px;stroke:var(--text);fill:none;stroke-width:2.5;}
.img-nav{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:6px;z-index:10;}
.img-dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.3);cursor:pointer;transition:.2s;}
.img-dot.active{background:var(--accent);width:20px;border-radius:4px;}
.det-body{flex:1;overflow-y:auto;padding:16px 18px 90px;-webkit-overflow-scrolling:touch;}
.det-name{font-size:19px;font-weight:800;}
.det-rat{display:flex;align-items:center;gap:5px;margin:5px 0;}
.det-desc{font-size:12.5px;color:var(--dim);line-height:1.6;margin-top:8px;}
.det-prow{display:flex;align-items:center;gap:9px;margin-top:12px;}
.det-price{font-size:22px;font-weight:800;color:var(--accent);}
.det-pold{font-size:13px;color:var(--dim);text-decoration:line-through;}
.det-foot{position:absolute;bottom:0;left:0;right:0;padding:12px 18px;background:var(--bg);border-top:1px solid var(--border);}

/* ===== CHECKOUT SHEET ===== */
#checkoutSheet{height:82vh;}
.checkout-body{flex:1;overflow-y:auto;padding:16px 18px 100px;-webkit-overflow-scrolling:touch;}
.checkout-summary{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:14px;margin-bottom:18px;}
.cs-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;}
.cs-row:last-child{border-top:1px solid var(--border);margin-top:6px;padding-top:8px;}
.cs-l{font-size:13px;color:var(--dim);}
.cs-v{font-size:13px;font-weight:600;color:var(--text);}
.cs-total .cs-v{font-size:18px;color:var(--accent);font-weight:800;}
.sec-t{font-size:14px;font-weight:700;color:var(--text);margin-bottom:8px;}

/* Payment Cards */
.pay-cards{display:flex;flex-direction:column;gap:10px;margin-bottom:20px;}
.pay-card{background:var(--card);border:2px solid var(--border);border-radius:var(--r);padding:14px 16px;cursor:pointer;transition:border-color .25s,background .25s;display:flex;align-items:center;gap:14px;}
.pay-card:active{transform:scale(.97);}
.pay-card.on{border-color:var(--accent);background:rgba(64,224,208,.06);}
.pay-card.on .pay-radio{background:var(--accent);border-color:var(--accent);}
.pay-card.on .pay-radio::after{opacity:1;}
.pay-radio{width:22px;height:22px;border-radius:50%;border:2px solid var(--border);background:var(--card);flex-shrink:0;position:relative;transition:.2s;}
.pay-radio::after{content:'';position:absolute;top:4px;left:4px;right:4px;bottom:4px;border-radius:50%;background:#fff;opacity:0;transition:opacity .2s;}
.pay-ic{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.pay-ic.cod{background:linear-gradient(135deg,#1e3a2e,#0d2818);}
.pay-ic.bank{background:linear-gradient(135deg,#1e1e3a,#18182e);}
.pay-txt .pay-title{font-size:14px;font-weight:700;color:var(--text);}
.pay-txt .pay-sub{font-size:11.5px;color:var(--dim);margin-top:1px;}

/* Bank Details Box */
.bank-box{background:rgba(64,224,208,.07);border:1px solid rgba(64,224,208,.25);border-radius:var(--rs);padding:14px;margin-top:-6px;margin-bottom:16px;display:none;}
.bank-box.show{display:block;}
.bank-box-title{font-size:12px;font-weight:700;color:var(--accent);margin-bottom:8px;display:flex;align-items:center;gap:6px;}
.bank-account-option{background:var(--bg)!important;border:2px solid var(--border)!important;border-radius:10px!important;padding:12px!important;margin-bottom:10px!important;cursor:pointer!important;transition:all .2s!important;}
.bank-account-option:hover{border-color:var(--accent)!important;transform:translateX(-2px);}
.bank-account-option.selected{border-color:var(--accent)!important;}
.bank-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid rgba(64,224,208,.12);}
.bank-row:last-child{border:none;}
.bank-l{font-size:11.5px;color:var(--dim);}
.bank-v{font-size:12.5px;font-weight:700;color:var(--text);display:flex;align-items:center;gap:6px;}
.copy-btn{width:22px;height:22px;border-radius:5px;background:rgba(64,224,208,.15);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s;}
.copy-btn:active{background:rgba(64,224,208,.3);}
.copy-btn svg{width:12px;height:12px;stroke:var(--accent);fill:none;stroke-width:2;}
.upload-area{border:2px dashed var(--border);border-radius:var(--rs);padding:18px;text-align:center;cursor:pointer;transition:border-color .25s;margin-top:6px;}
.upload-area:hover,.upload-area.has-file{border-color:var(--accent);}
.upload-area svg{width:28px;height:28px;stroke:var(--dim);fill:none;stroke-width:1.5;margin-bottom:6px;}
.upload-area p{font-size:12.5px;color:var(--dim);font-weight:600;}
.upload-area span{font-size:11px;color:var(--dim);opacity:.6;}
.upload-area .file-name{font-size:12px;color:var(--accent);font-weight:700;margin-top:4px;display:none;}
.upload-area.has-file .file-name{display:block;}
.upload-area.has-file p{color:var(--success);}
.upload-area input[type=file]{display:none;}

/* Delivery Info */
.info-group{margin-bottom:16px;}
.info-group label{display:block;font-size:12px;font-weight:600;color:var(--dim);margin-bottom:5px;}
.info-input{width:100%;padding:10px 13px;background:var(--card);border:1px solid var(--border);border-radius:var(--rs);color:var(--text);font-family:inherit;font-size:13px;outline:none;transition:border-color .25s;}
.info-input::placeholder{color:var(--dim);}
.info-input:focus{border-color:var(--accent);}
.checkout-foot{position:absolute;bottom:0;left:0;right:0;padding:12px 18px;background:var(--bg);border-top:1px solid var(--border);}

/* ===== SUCCESS OVERLAY ===== */
.success-screen{position:fixed;inset:0;background:var(--bg);z-index:300;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;text-align:center;opacity:0;pointer-events:none;transition:opacity .4s;}
.success-screen.on{opacity:1;pointer-events:auto;}
.success-ic{width:90px;height:90px;border-radius:50%;background:linear-gradient(135deg,var(--success),#00b84e);display:flex;align-items:center;justify-content:center;font-size:40px;margin-bottom:20px;animation:popIn .4s cubic-bezier(.4,0,.2,1);}
@keyframes popIn{from{transform:scale(0);opacity:0;}to{transform:scale(1);opacity:1;}}
.success-screen h2{font-size:22px;font-weight:800;color:var(--text);margin-bottom:8px;}
.success-screen p{font-size:13px;color:var(--dim);line-height:1.6;margin-bottom:28px;}
.success-btn{padding:13px 40px;border-radius:15px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:#fff;font-family:inherit;font-size:15px;font-weight:700;cursor:pointer;}

/* ===== ADMIN PANEL ===== */
.admin-header{background:var(--card);border-bottom:1px solid var(--border);padding:14px 18px;position:sticky;top:0;z-index:100;}
.admin-header-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:2px;}
.admin-title{font-size:18px;font-weight:800;color:var(--accent);}
.admin-title span{color:var(--text);}
.back-store{background:none;border:none;color:var(--dim);font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:4px;}
.back-store svg{width:14px;height:14px;stroke:var(--dim);fill:none;stroke-width:2.5;}
.admin-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;padding:14px 18px;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:var(--rs);padding:12px 10px;text-align:center;}
.stat-n{font-size:22px;font-weight:800;color:var(--accent);}
.stat-l{font-size:10.5px;color:var(--dim);margin-top:2px;}
.admin-actions{padding:0 18px 12px;display:flex;gap:8px;}
.admin-btn{flex:1;padding:10px;border-radius:var(--rs);border:none;font-family:inherit;font-size:12.5px;font-weight:700;cursor:pointer;transition:transform .2s;display:flex;align-items:center;justify-content:center;gap:6px;}
.admin-btn:active{transform:scale(.94);}
.admin-btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;box-shadow:0 4px 14px rgba(64,224,208,.3);}
.admin-btn.secondary{background:var(--card);border:1px solid var(--border);color:var(--text);}
.admin-btn svg{width:15px;height:15px;stroke:currentColor;fill:none;stroke-width:2.5;}
.admin-products{padding:0 18px 10px;}
.admin-pcard{background:var(--card);border:1px solid var(--border);border-radius:var(--rs);padding:12px;display:flex;align-items:center;gap:12px;margin-bottom:8px;}
.admin-pic{width:52px;height:52px;background:linear-gradient(135deg,#1e1e35,#252545);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;overflow:hidden;}
.admin-pic img{width:100%;height:100%;object-fit:cover;}
.admin-pd{flex:1;min-width:0;}
.admin-pn{font-size:13px;font-weight:600;color:var(--text);}
.admin-ps{font-size:12px;color:var(--accent);font-weight:700;margin-top:1px;}
.admin-pc{font-size:10.5px;color:var(--dim);}
.admin-acts{display:flex;gap:6px;}
.admin-ab{width:32px;height:32px;border-radius:8px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .15s;}
.admin-ab:active{transform:scale(.88);}
.admin-ab svg{width:15px;height:15px;stroke:#fff;fill:none;stroke-width:2;}
.admin-ab.edit{background:#20B2AA;}
.admin-ab.del{background:var(--danger);}

/* ===== ADD/EDIT PRODUCT MODAL ===== */
#prodModal{height:85vh;}
.modal-body{flex:1;overflow-y:auto;padding:16px 18px 100px;-webkit-overflow-scrolling:touch;}
.modal-foot{position:absolute;bottom:0;left:0;right:0;padding:12px 18px;background:var(--bg);border-top:1px solid var(--border);}
.icon-picker{display:flex;gap:8px;flex-wrap:wrap;}
.icon-opt{width:40px;height:40px;border-radius:10px;background:var(--card);border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:.2s;}
.icon-opt:active{transform:scale(.9);}
.icon-opt.on{border-color:var(--accent);background:rgba(64,224,208,.1);}

/* Image Upload for Products */
.img-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px;}
.img-slot{aspect-ratio:1;border:2px dashed var(--border);border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;transition:.2s;}
.img-slot:hover{border-color:var(--accent);}
.img-slot.has-img{border-style:solid;border-color:var(--accent);}
.img-slot img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
.img-slot .add-ic{font-size:24px;color:var(--dim);}
.img-slot .remove-ic{position:absolute;top:4px;right:4px;width:20px;height:20px;border-radius:50%;background:var(--danger);color:#fff;font-size:12px;display:none;align-items:center;justify-content:center;cursor:pointer;z-index:2;}
.img-slot.has-img .remove-ic{display:flex;}

/* TOAST */
.toast{position:fixed;bottom:calc(80px + var(--safe-bot));left:50%;transform:translateX(-50%) translateY(80px);background:var(--card);border:1px solid var(--border);border-radius:var(--rs);padding:12px 20px;font-size:13px;font-weight:600;color:var(--text);z-index:400;opacity:0;pointer-events:none;transition:all .3s;box-shadow:0 8px 24px rgba(0,0,0,.3);}
.toast.on{transform:translateX(-50%) translateY(0);opacity:1;}

/* ANIMATIONS */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.pcard,.admin-pcard{animation:fadeUp .32s ease both;}

/* SCROLLBAR */
::-webkit-scrollbar{width:3px;}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.08);border-radius:2px;}
</style>
</head>
<body>

<!-- ========== STORE PAGE ========== -->
<div class="page active" id="storePage">
  <header class="header">
    <div class="header-top">
      <div class="store-title">ğŸ›ï¸ Ù…ØªØ¬Ø± Ø£ÙŠÙˆÙ†</div>
      <div class="header-actions">
        <button class="icon-btn" onclick="openCart()">
          <svg viewBox="0 0 24 24"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
          <span class="badge" id="cartBadge">0</span>
        </button>
      </div>
    </div>
    <div class="search-wrap">
      <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input class="search-input" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." id="searchInput" oninput="filterProducts()"/>
    </div>
  </header>
  <div class="cats" id="catsWrap"></div>
  <div class="banner">
    <div class="shapes"><div class="sh sh1"></div><div class="sh sh2"></div></div>
    <div class="banner-c">
      <span class="banner-tag">âš¡ Ø£ÙØ¶Ù„ Ø§Ù„ØµÙÙ‚Ø§Øª</span>
      <div class="banner-t">Ø®ØµÙˆÙ…Ø§Øª Ø­ØªÙ‰ 50%<br/>Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</div>
      <div class="banner-s">Ù„ÙØªØ±Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© ÙÙ‚Ø·</div>
    </div>
  </div>
  <div class="sec-label">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
  <div class="grid" id="productsGrid"></div>
</div>

<!-- ========== ADMIN PAGE ========== -->
<div class="page" id="adminPage">
  <div class="admin-header">
    <div class="admin-header-top">
      <div class="admin-title"><span>Ù„ÙˆØ­Ø©</span> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
      <button class="back-store" onclick="goStore()"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg> Ø§Ù„Ù…ØªØ¬Ø±</button>
    </div>
  </div>
  <div class="admin-stats" id="adminStats"></div>
  <div class="admin-actions">
    <button class="admin-btn primary" onclick="openProdModal(null)"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</button>
    <button class="admin-btn secondary" onclick="testTelegram()" style="flex:none;">
      ğŸ“± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
    </button>
    <button class="admin-btn secondary" onclick="toggleBankSection()" style="flex:none;">
      ğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©
    </button>
    <button class="admin-btn secondary" onclick="clearLocalStorage()" style="flex:none;background:var(--danger);border-color:var(--danger);">
      ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    </button>
    <div class="currency-selector" style="position:relative;">
      <button class="admin-btn secondary" onclick="toggleCurrencyMenu()" style="flex:none;min-width:140px;">
        ğŸ’± <span id="currencyDisplay">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</span>
        <svg style="width:12px;height:12px;margin-right:4px;" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9" stroke="currentColor" fill="none" stroke-width="2"/></svg>
      </button>
      <div class="currency-menu" id="currencyMenu">
        <div class="currency-opt active" onclick="changeCurrency('Ø±ÙŠØ§Ù„')">ğŸ‡¸ğŸ‡¦ Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</div>
        <div class="currency-opt" onclick="changeCurrency('Ø¬Ù†ÙŠÙ‡')">ğŸ‡¸ğŸ‡© Ø¬Ù†ÙŠÙ‡ Ø³ÙˆØ¯Ø§Ù†ÙŠ</div>
        <div class="currency-opt" onclick="changeCurrency('Ø¯ÙˆÙ„Ø§Ø±')">ğŸ‡ºğŸ‡¸ Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</div>
        <div class="currency-opt" onclick="changeCurrency('ÙŠÙˆØ±Ùˆ')">ğŸ‡ªğŸ‡º ÙŠÙˆØ±Ùˆ</div>
      </div>
    </div>
  </div>
  
  <!-- Bank Accounts Section -->
  <div id="bankAccountsSection" style="display:none;padding:0 18px 12px;">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:14px;margin-bottom:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <h4 style="font-size:14px;font-weight:700;color:var(--accent);">ğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©</h4>
        <button class="admin-btn primary" onclick="openBankModal(null)" style="padding:6px 12px;font-size:11px;">+ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <div id="bankAccountsList"></div>
    </div>
  </div>
  
  <div class="admin-products" id="adminProducts"></div>
</div>

<!-- ========== BOTTOM NAV ========== -->
<nav class="bnav" id="bottomNav">
  <button class="ni on" onclick="navClick('home',this)"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>Ø§Ù„Ø¨ÙŠØª</button>
  <button class="ni" onclick="navClick('explore',this)"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>Ø§Ø³ØªÙƒØ´Ø§Ù</button>
  <button class="ni" onclick="navClick('fav',this)"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>Ø§Ù„Ù…Ø­Ø¨ÙˆØ¨</button>
</nav>

<!-- ========== CART SHEET ========== -->
<div class="overlay" id="cartOverlay" onclick="closeCart()"></div>
<div class="sheet" id="cartSheet">
  <div class="sheet-handle"></div>
  <div class="sheet-head"><h3>ğŸ›’ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3><button class="close-btn" onclick="closeCart()"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
  <div class="cart-items" id="cartItems"></div>
  <div class="sheet-foot" id="cartFooter">
    <div class="total-row"><span class="total-l">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span><span class="total-v" id="cartTotal">0</span></div>
    <button class="grd-btn" onclick="openCheckout()">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ â†’</button>
  </div>
</div>

<!-- ========== DETAIL SHEET ========== -->
<div class="overlay" id="detailOverlay" onclick="closeDetail()"></div>
<div class="sheet" id="detailSheet">
  <div class="det-img" id="detImgContainer">
    <div class="det-img-scroll" id="detImgScroll">
      <!-- Ø§Ù„ØµÙˆØ± Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>
    <div class="img-nav" id="imgNav"></div>
    <button class="det-close" onclick="closeDetail()"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
  </div>
  <div class="det-body">
    <div class="det-name" id="detName"></div>
    <div class="det-rat" id="detRat"></div>
    <div class="det-desc" id="detDesc"></div>
    <div class="det-prow"><span class="det-price" id="detPrice"></span><span class="det-pold" id="detPold"></span></div>
  </div>
  <div class="det-foot"><button class="grd-btn" id="detAddBtn">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button></div>
</div>

<!-- ========== CHECKOUT SHEET ========== -->
<div class="overlay" id="checkoutOverlay" onclick="closeCheckout()"></div>
<div class="sheet" id="checkoutSheet">
  <div class="sheet-handle"></div>
  <div class="sheet-head"><h3>ğŸ’³ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h3><button class="close-btn" onclick="closeCheckout()"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
  <div class="checkout-body">
    <!-- Order Summary -->
    <div class="checkout-summary" id="orderSummary"></div>

    <!-- Delivery Info -->
    <div class="sec-t">ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
    <div class="info-group"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input class="info-input" id="inpName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯"/></div>
    <div class="info-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input class="info-input" id="inpPhone" type="tel" placeholder="+966 5xx xxx xxxx"/></div>
    <div class="info-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input class="info-input" id="inpAddr" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹..."/></div>

    <!-- Payment Method -->
    <div class="sec-t" style="margin-top:18px;">ğŸ’° Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
    <div class="pay-cards">
      <div class="pay-card on" id="payCOD" onclick="selectPay('cod')">
        <div class="pay-radio"></div>
        <div class="pay-ic cod">ğŸšš</div>
        <div class="pay-txt"><div class="pay-title">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</div><div class="pay-sub">Ø§Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ø±Ø¯</div></div>
      </div>
      <div class="pay-card" id="payBank" onclick="selectPay('bank')">
        <div class="pay-radio"></div>
        <div class="pay-ic bank">ğŸ¦</div>
        <div class="pay-txt"><div class="pay-title">Ø­ÙˆØ§Ù„Ø© Ø¨Ù†ÙƒÙŠØ©</div><div class="pay-sub">Ù†Ù‚Ù„ Ù…Ø¨Ø§Ø´Ø± Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ</div></div>
      </div>
    </div>

    <!-- Bank Accounts Selection & Details -->
    <div class="bank-box" id="bankBox">
      <!-- Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>
  </div>
  <div class="checkout-foot">
    <button class="grd-btn" id="confirmBtn" onclick="confirmOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
  </div>
</div>

<!-- ========== SUCCESS SCREEN ========== -->
<div class="success-screen" id="successScreen">
  <div class="success-ic">âœ“</div>
  <h2>Ø·Ù„Ø¨Ùƒ ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰</h2>
  <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ.<br/>Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>
  <button class="success-btn" onclick="closeSuccess()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±</button>
</div>

<!-- ========== ADD/EDIT PRODUCT MODAL ========== -->
<div class="overlay" id="modalOverlay" onclick="closeProdModal()"></div>
<div class="sheet" id="prodModal">
  <div class="sheet-handle"></div>
  <div class="sheet-head"><h3 id="modalTitle">â• Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3><button class="close-btn" onclick="closeProdModal()"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
  <div class="modal-body">
    <input type="hidden" id="editId" value=""/>
    <div class="info-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label><input class="info-input" id="mpName" placeholder="Ù…Ø«Ø§Ù„: Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø³Ù„ÙƒÙŠØ© Pro"/></div>
    <div class="info-group"><label>Ø§Ù„ÙØ¦Ø©</label><input class="info-input" id="mpCat" placeholder="Ù…Ø«Ø§Ù„: Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª"/></div>
    <div class="info-group"><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label><input class="info-input" id="mpPrice" type="number" placeholder="299"/></div>
    <div class="info-group"><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input class="info-input" id="mpOldPrice" type="number" placeholder="450"/></div>
    <div class="info-group"><label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (Ù…Ù† 5)</label><input class="info-input" id="mpRating" type="number" step="0.1" placeholder="4.8" min="0" max="5"/></div>
    <div class="info-group"><label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</label><input class="info-input" id="mpReviews" type="number" placeholder="128"/></div>
    <div class="info-group"><label>Ø§Ù„ÙˆØµÙ</label><textarea class="info-input" id="mpDesc" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬..." style="resize:none;border-radius:var(--rs);"></textarea></div>
    <div class="info-group">
      <label>ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ (Ø­ØªÙ‰ 5 ØµÙˆØ±)</label>
      <div class="img-grid" id="imgGrid">
        <div class="img-slot" onclick="selectImageSlot(0)"><span class="add-ic">+</span><span class="remove-ic" onclick="event.stopPropagation();removeImage(0)">Ã—</span></div>
        <div class="img-slot" onclick="selectImageSlot(1)"><span class="add-ic">+</span><span class="remove-ic" onclick="event.stopPropagation();removeImage(1)">Ã—</span></div>
        <div class="img-slot" onclick="selectImageSlot(2)"><span class="add-ic">+</span><span class="remove-ic" onclick="event.stopPropagation();removeImage(2)">Ã—</span></div>
        <div class="img-slot" onclick="selectImageSlot(3)"><span class="add-ic">+</span><span class="remove-ic" onclick="event.stopPropagation();removeImage(3)">Ã—</span></div>
        <div class="img-slot" onclick="selectImageSlot(4)"><span class="add-ic">+</span><span class="remove-ic" onclick="event.stopPropagation();removeImage(4)">Ã—</span></div>
      </div>
      <input type="file" id="prodImgFile" accept="image/*" style="display:none;" onchange="onProdImgSelect(event)"/>
    </div>
    <div class="info-group">
      <label>Ø§Ù„Ø£ÙŠÙƒÙˆÙ† (Ø¨Ø¯ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ù… ØªØ¶Ù ØµÙˆØ±)</label>
      <div class="icon-picker" id="iconPicker"></div>
    </div>
  </div>
  <div class="modal-foot">
    <button class="grd-btn" id="saveProductBtn" onclick="saveProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
  </div>
</div>

<!-- ========== BANK ACCOUNT MODAL ========== -->
<div class="overlay" id="bankModalOverlay" onclick="closeBankModal()"></div>
<div class="sheet" id="bankModal" style="height:70vh;">
  <div class="sheet-handle"></div>
  <div class="sheet-head"><h3 id="bankModalTitle">ğŸ¦ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ø¬Ø¯ÙŠØ¯</h3><button class="close-btn" onclick="closeBankModal()"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
  <div class="modal-body">
    <input type="hidden" id="editBankId" value=""/>
    <div class="info-group"><label>Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</label><input class="info-input" id="bankName" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø±ÙƒØ© Ø£ÙŠÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©"/></div>
    <div class="info-group"><label>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</label><input class="info-input" id="bankAccountNum" placeholder="1234-5678-9012-3456"/></div>
    <div class="info-group"><label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label><input class="info-input" id="bankBankName" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ù†Ùƒ Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ"/></div>
    <div class="info-group"><label>Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† (IBAN) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ</label><input class="info-input" id="bankIban" placeholder="SA1234567890123456"/></div>
  </div>
  <div class="modal-foot">
    <button class="grd-btn" onclick="saveBankAccount()">Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============================================================
// GITHUB GIST STORAGE (Ø¨Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ù„Ù€ Firebase)
// ============================================================

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub Gist
const GIST_CONFIG = {
  // Ø¶Ø¹ Personal Access Token Ù…Ù† GitHub Ù‡Ù†Ø§
  token: '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',
  // Ø¶Ø¹ Ù…Ø¹Ø±Ù Ø§Ù„Ù€ Gist Ù‡Ù†Ø§ (Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
  gistId: 'd28317d6cc3fc1f9f92be065705d5f20'
};

let gistEnabled = false;

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Gist
function checkGistConfig(){
  if(GIST_CONFIG.token === 'YOUR_GITHUB_TOKEN' || GIST_CONFIG.gistId === 'YOUR_GIST_ID'){
    console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ GitHub Gist. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… LocalStorage');
    console.log('%cğŸ“– Ù„Ø¥Ø¹Ø¯Ø§Ø¯ GitHub Gist:', 'color: #FFD700; font-weight: bold;');
    console.log('1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ GitHub Settings â†’ Developer settings â†’ Personal access tokens');
    console.log('2. Ø£Ù†Ø´Ø¦ Token Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØµÙ„Ø§Ø­ÙŠØ© "gist"');
    console.log('3. Ø§Ù†Ø³Ø® Ø§Ù„Ù€ Token ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø³Ø·Ø± 513');
    console.log('4. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Gist ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø­ÙØ¸');
    return false;
  }
  gistEnabled = true;
  return true;
}

// Ø¥Ù†Ø´Ø§Ø¡ Gist Ø¬Ø¯ÙŠØ¯
async function createGist(){
  try {
    const data = {
      products: products,
      bankAccounts: bankAccounts,
      currentCurrency: currentCurrency,
      nextId: nextId,
      nextBankId: nextBankId,
      lastUpdated: new Date().toISOString()
    };
    
    const response = await fetch('https://api.github.com/gists', {
      method: 'POST',
      headers: {
        'Authorization': `token ${GIST_CONFIG.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        description: 'Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ¬Ø± Ø£ÙŠÙˆÙ† - Ayon Store Data',
        public: false,
        files: {
          'store_data.json': {
            content: JSON.stringify(data, null, 2)
          }
        }
      })
    });
    
    if(response.ok){
      const result = await response.json();
      GIST_CONFIG.gistId = result.id;
      
      console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Gist Ø¨Ù†Ø¬Ø§Ø­!');
      console.log('%cğŸ“‹ Ø§Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù:', 'color: #40E0D0; font-weight: bold;');
      console.log(`Gist ID: ${result.id}`);
      console.log('%cØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø³Ø·Ø± 514 Ù…Ù† Ø§Ù„ÙƒÙˆØ¯', 'color: orange;');
      
      toast('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      return true;
    }
  } catch(error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Gist:', error);
  }
  return false;
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Gist
async function saveToGist(){
  if(!checkGistConfig()){
    saveToLocalStorage();
    return;
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Gist ID
  if(GIST_CONFIG.gistId === 'YOUR_GIST_ID'){
    console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Gist ID');
    console.log('ğŸ’¡ Ø£Ù†Ø´Ø¦ Gist ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù†: https://gist.github.com/');
    saveToLocalStorage();
    return;
  }
  
  try {
    const data = {
      products: products,
      bankAccounts: bankAccounts,
      currentCurrency: currentCurrency,
      nextId: nextId,
      nextBankId: nextBankId,
      lastUpdated: new Date().toISOString()
    };
    
    console.log('â˜ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ GitHub Gist...');
    
    const response = await fetch(`https://api.github.com/gists/${GIST_CONFIG.gistId}`, {
      method: 'PATCH',
      headers: {
        'Authorization': `token ${GIST_CONFIG.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        files: {
          'store_data.json': {
            content: JSON.stringify(data, null, 2)
          }
        }
      })
    });
    
    if(response.ok){
      console.log('â˜ï¸ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub Gist Ø¨Ù†Ø¬Ø§Ø­');
      toast('â˜ï¸ ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
      
      // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© Ø£ÙŠØ¶Ø§Ù‹
      saveToLocalStorage();
    } else {
      const errorData = await response.json();
      throw new Error(`HTTP ${response.status}: ${errorData.message || response.statusText}`);
    }
  } catch(error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø¥Ù„Ù‰ Gist:', error.message);
    console.log('ğŸ’¡ ØªØ£ÙƒØ¯ Ù…Ù†:');
    console.log('1. ØµØ­Ø© Token');
    console.log('2. ØµØ­Ø© Gist ID');
    console.log('3. ØµÙ„Ø§Ø­ÙŠØ§Øª Token');
    console.log('ğŸ’¾ Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·...');
    saveToLocalStorage();
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Gist
async function loadFromGist(){
  if(!checkGistConfig()){
    return loadFromLocalStorage();
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Gist ID
  if(GIST_CONFIG.gistId === 'YOUR_GIST_ID'){
    console.log('%cğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø£Ù†Ø´Ø¦ Gist ÙŠØ¯ÙˆÙŠØ§Ù‹!', 'color: #40E0D0; font-weight: bold;');
    console.log('1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: https://gist.github.com/');
    console.log('2. New gist');
    console.log('3. Ø§Ù„Ù…Ù„Ù: store_data.json');
    console.log('4. Ø§Ù„Ù…Ø­ØªÙˆÙ‰: Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù initial_store_data.json');
    console.log('5. Create secret gist');
    console.log('6. Ø§Ù†Ø³Ø® ID Ù…Ù† URL ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø³Ø·Ø± 529');
    return loadFromLocalStorage();
  }
  
  try {
    console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† GitHub Gist...');
    
    const response = await fetch(`https://api.github.com/gists/${GIST_CONFIG.gistId}`, {
      headers: {
        'Authorization': `token ${GIST_CONFIG.token}`
      }
    });
    
    if(response.ok){
      const gist = await response.json();
      const fileKey = Object.keys(gist.files)[0]; // Ø£ÙˆÙ„ Ù…Ù„Ù ÙÙŠ Ø§Ù„Ù€ Gist
      const content = gist.files[fileKey].content;
      const data = JSON.parse(content);
      
      if(data.products && data.products.length > 0){
        products = data.products;
        nextId = data.nextId || products.length + 1;
      }
      
      if(data.bankAccounts && data.bankAccounts.length > 0){
        bankAccounts = data.bankAccounts;
        nextBankId = data.nextBankId || bankAccounts.length + 1;
      }
      
      if(data.currentCurrency){
        currentCurrency = data.currentCurrency;
      }
      
      console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Gist');
      console.log(`ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${products.length}`);
      console.log(`ğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©: ${bankAccounts.length}`);
      console.log(`ğŸ“… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date(data.lastUpdated).toLocaleString('ar')}`);
      
      // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ©
      saveToLocalStorage();
      
      return true;
    } else {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
  } catch(error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Gist:', error.message);
    console.log('ğŸ’¡ ØªØ£ÙƒØ¯ Ù…Ù†:');
    console.log('1. ØµØ­Ø© Token (Ø§Ù„Ø³Ø·Ø± 527)');
    console.log('2. ØµØ­Ø© Gist ID (Ø§Ù„Ø³Ø·Ø± 529)');
    console.log('3. Ø£Ù† Token Ù„Ù‡ ØµÙ„Ø§Ø­ÙŠØ© "gist"');
    console.log('Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† LocalStorage...');
  }
  
  return loadFromLocalStorage();
}

// Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø© (Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡)
async function refreshFromCloud(){
  if(!gistEnabled && GIST_CONFIG.gistId === 'YOUR_GIST_ID'){
    toast('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©');
    return;
  }
  
  toast('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...');
  
  const success = await loadFromGist();
  
  if(success){
    // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… ÙƒÙ„ Ø´ÙŠØ¡
    renderCats();
    renderProducts(getFilteredProducts());
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…ÙØªÙˆØ­Ø©
    if(document.getElementById('adminPage').classList.contains('active')){
      renderAdmin();
    }
    
    toast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
  } else {
    toast('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« - ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
  }
}

// ============================================================
// CONFIG & DATA
// ============================================================

const APP_CONFIG = {
  telegramBotToken: '8251605027:AAE4V2kvdj3K4qiS_8D4KgMlR4U7wxQtioE', // âš ï¸ Ø¶Ø¹ Bot Token Ù‡Ù†Ø§ Ù…Ù† @BotFather
  telegramAdminChatId: '7380362549', // âš ï¸ Ø¶Ø¹ Chat ID Ù‡Ù†Ø§ Ù…Ù† @userinfobot
};

// ØªØ­Ø°ÙŠØ± Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
if(APP_CONFIG.telegramBotToken === 'YOUR_BOT_TOKEN_HERE' || APP_CONFIG.telegramAdminChatId === 'YOUR_CHAT_ID_HERE'){
  console.warn('%câš ï¸ ØªØ­Ø°ÙŠØ±: Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Bot Token Ùˆ Chat ID', 'color: orange; font-size: 16px; font-weight: bold;');
  console.log('%cØ§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø³ÙŠØ¹Ù…Ù„ØŒ Ù„ÙƒÙ† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù† ØªÙØ±Ø³Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…', 'color: yellow;');
  console.log('%cÙ„Ù„Ø¥Ø¹Ø¯Ø§Ø¯:', 'color: #40E0D0; font-weight: bold;');
  console.log('1. Ø§Ù„Ø³Ø·Ø± 735: Bot Token Ù…Ù† @BotFather');
  console.log('2. Ø§Ù„Ø³Ø·Ø± 736: Chat ID Ù…Ù† @userinfobot');
}

// Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
const CURRENCIES = {
  'Ø±ÙŠØ§Ù„': {name: 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ', symbol: 'Ø±.Ø³'},
  'Ø¬Ù†ÙŠÙ‡': {name: 'Ø¬Ù†ÙŠÙ‡ Ø³ÙˆØ¯Ø§Ù†ÙŠ', symbol: 'Ø¬.Ø³'},
  'Ø¯ÙˆÙ„Ø§Ø±': {name: 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ', symbol: '$'},
  'ÙŠÙˆØ±Ùˆ': {name: 'ÙŠÙˆØ±Ùˆ', symbol: 'â‚¬'}
};

let currentCurrency = 'Ø±ÙŠØ§Ù„'; // Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

// Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©
let bankAccounts = [
  {id:1, name:'Ø´Ø±ÙƒØ© Ø£ÙŠÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©', accountNumber:'1234-5678-9012-3456', bank:'Ø¨Ù†Ùƒ Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', iban:'SA1234567890123456', active:true},
];
let nextBankId = 2;

// ============================================================
// LOCAL STORAGE - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
// ============================================================

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function saveToLocalStorage(){
  try {
    const data = {
      products: products,
      bankAccounts: bankAccounts,
      nextId: nextId,
      nextBankId: nextBankId,
      currentCurrency: currentCurrency
    };
    localStorage.setItem('ayonStore_data', JSON.stringify(data));
    console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
  } catch(e) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', e);
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function loadFromLocalStorage(){
  try {
    const saved = localStorage.getItem('ayonStore_data');
    if(saved) {
      const data = JSON.parse(saved);
      if(data.products && data.products.length > 0) {
        products = data.products;
        nextId = data.nextId || products.length + 1;
      }
      if(data.bankAccounts && data.bankAccounts.length > 0) {
        bankAccounts = data.bankAccounts;
        nextBankId = data.nextBankId || bankAccounts.length + 1;
      }
      if(data.currentCurrency) {
        currentCurrency = data.currentCurrency;
      }
      console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©');
      console.log(`ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${products.length}`);
      console.log(`ğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©: ${bankAccounts.length}`);
      return true;
    }
  } catch(e) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', e);
  }
  return false;
}

// Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©)
function clearLocalStorage(){
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!')){
    localStorage.removeItem('ayonStore_data');
    location.reload();
  }
}

let products = [
  {id:1,name:'Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø³Ù„ÙƒÙŠØ© Pro',cat:'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª',icon:'ğŸ§',price:299,oldPrice:450,rating:4.8,reviews:128,desc:'Ø³Ù…Ø§Ø¹Ø§Øª ÙÙˆÙ‚ Ø§Ù„Ø£Ø°Ù† Ù…Ø¹ Ø®Ø§ØµÙŠØ© Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ Ø§Ù„ÙØ¹Ù‘Ø§Ù„ØŒ Ø¨Ø·Ø§Ø±ÙŠØ© 40 Ø³Ø§Ø¹Ø©ØŒ Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ù…Ø§Ø¡. ØµÙˆØª Ù†Ù‚ÙŠ ÙˆØ¨ÙŠØ³ Ù‚ÙˆÙŠ.',imgs:[]},
  {id:2,name:'Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ© X10',cat:'Ø§Ù„Ø³Ø§Ø¹Ø§Øª',icon:'âŒš',price:549,oldPrice:800,rating:4.6,reviews:95,desc:'Ø´Ø§Ø´Ø© AMOLED ÙƒØ±ÙŠØ³ØªØ§Ù„ØŒ Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ù…Ø§Ø¡ Ø­ØªÙ‰ 50 Ù…ØªØ±. ØªØªØ§Ø¨Ø¹ Ø§Ù„Ù†Ø¨Ø¶ ÙˆØ¶ØºØ· Ø§Ù„Ø¯Ù… ÙˆØ§Ù„Ù†ÙˆÙ….',imgs:[]},
  {id:3,name:'Ø­Ø°Ø§Ø¡ Ø±ÙŠØ§Ø¶ÙŠ Ultra',cat:'Ø§Ù„Ø£Ø­Ø°ÙŠØ©',icon:'ğŸ‘Ÿ',price:189,oldPrice:280,rating:4.9,reviews:213,desc:'Ù…ÙˆØ§Ø¯ Ù…ØªØ·ÙˆØ±Ø© ØªØ¹Ø·ÙŠ Ø£Ù‚ØµÙ‰ Ø±Ø§Ø­Ø©. ÙƒØ¹Ø¨ Ù…Ø·Ø§Ø·ÙŠ ÙŠÙ…ØªØµ Ø§Ù„ØµØ¯Ù…Ø§Øª Ø¨Ù†Ø³Ø¨Ø© 95%.',imgs:[]},
  {id:4,name:'ÙƒØ§Ù…ÙŠØ±Ø§ ÙƒÙŠÙ… Ø§Ù„ØµØºÙŠØ±Ø©',cat:'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª',icon:'ğŸ“·',price:399,oldPrice:600,rating:4.5,reviews:67,desc:'ÙƒØ§Ù…ÙŠØ±Ø§ Ù…ØµØºØ±Ø© Ø¨Ø¯Ù‚Ø© 4K Ù„Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ.',imgs:[]},
  {id:5,name:'Ø­Ù‚ÙŠØ¨Ø© Ø¬Ù„Ø¯ ÙØ§Ø®Ø±',cat:'Ø§Ù„Ø­Ù‚ÙŠØ¨',icon:'ğŸ‘œ',price:159,oldPrice:250,rating:4.7,reviews:154,desc:'Ø¬Ù„Ø¯ Ø­Ù‚ÙŠÙ‚ÙŠ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©. ØªØµÙ…ÙŠÙ… ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ Ø£Ù†ÙŠÙ‚ Ù…Ø¹ Ø£Ù‚Ø³Ø§Ù… Ø¯Ø§Ø®Ù„ÙŠØ© Ù…Ù†Ø¸Ù…Ø©.',imgs:[]},
  {id:6,name:'ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø©',cat:'Ø§Ù„ÙƒØªØ¨',icon:'ğŸ“š',price:49,oldPrice:75,rating:4.4,reviews:342,desc:'ÙƒØªØ§Ø¨ Ø´Ø§Ù…Ù„ ÙŠØºÙˆØµ ÙÙŠ Ø£Ø¹Ù…Ø§Ù‚ Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹.',imgs:[]},
  {id:7,name:'Ù†Ø¸Ø§Ø±Ø§Øª Ø´Ù…Ø³ Aviator',cat:'Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ±Ø§Øª',icon:'ğŸ•¶ï¸',price:129,oldPrice:200,rating:4.6,reviews:88,desc:'Ø¹Ø¯Ø³Ø§Øª Ù…Ø¶Ø§Ø¯Ø© Ù„Ù„Ø£Ø´Ø¹Ø© ÙÙˆÙ‚ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠØ© 100%. Ø¥Ø·Ø§Ø± Ù…Ø¹Ø¯Ù†ÙŠ ÙØ§Ø®Ø± Ø®ÙÙŠÙ Ø§Ù„ÙˆØ²Ù†.',imgs:[]},
  {id:8,name:'Ø­Ù‚ÙŠØ¨Ø© Ø¸Ù‡Ø± Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§',cat:'Ø§Ù„Ø­Ù‚ÙŠØ¨',icon:'ğŸ’',price:219,oldPrice:320,rating:4.8,reviews:176,desc:'Ù…Ù†ÙØ° Ø´Ø­Ù† USB ÙˆÙÙŠØ²ÙŠØ§Ø¦ÙŠ Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ù…Ø§Ø¡. Ø³Ø¹Ø© 45 Ù„ØªØ± Ù…Ø¹ Ù‚Ø³Ù… Ø®Ø§Øµ Ù„Ù„Ø­Ø§Ø³Ø¨.',imgs:[]},
];
let cart = [];
let favs = new Set();
let curCat = 'Ø§Ù„ÙƒÙ„';
let selectedPay = 'cod';
const ICONS = ['ğŸ§','âŒš','ğŸ‘Ÿ','ğŸ“·','ğŸ‘œ','ğŸ“š','ğŸ•¶ï¸','ğŸ’','ğŸ’»','ğŸ“±','ğŸ–¥ï¸','ğŸ®','ğŸµ','âš½','ğŸ‹ï¸','ğŸ‘—','ğŸ‘”','ğŸ’','ğŸ§´','ğŸ§³'];
let nextId = Math.max(...products.map(p=>p.id))+1;
let currentProductImgs = []; // Ø§Ù„ØµÙˆØ± Ù„Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
let currentViewImgIndex = 0; // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Detail Sheet
let selectedImgSlot = 0; // Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„ØµÙˆØ±Ø©
let uploadedReceipt = null; // ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…Ø±ÙÙ‚Ø©

// ============================================================
// CURRENCY
// ============================================================
function getCurrencySymbol(){
  return CURRENCIES[currentCurrency]?.symbol || 'Ø±.Ø³';
}

function toggleCurrencyMenu(){
  const menu = document.getElementById('currencyMenu');
  menu.classList.toggle('show');
  // Close when clicking outside
  if(menu.classList.contains('show')){
    setTimeout(()=>{
      document.addEventListener('click', closeCurrencyOnOutside);
    },100);
  }
}

function closeCurrencyOnOutside(e){
  const menu = document.getElementById('currencyMenu');
  const btn = document.querySelector('.currency-btn');
  if(!menu.contains(e.target) && !btn.contains(e.target)){
    menu.classList.remove('show');
    document.removeEventListener('click', closeCurrencyOnOutside);
  }
}

function changeCurrency(curr){
  currentCurrency = curr;
  document.getElementById('currencyDisplay').textContent = CURRENCIES[curr].name;
  document.getElementById('currencyMenu').classList.remove('show');
  document.removeEventListener('click', closeCurrencyOnOutside);
  
  // Update active state
  document.querySelectorAll('.currency-opt').forEach((opt,i)=>{
    const currencies = ['Ø±ÙŠØ§Ù„','Ø¬Ù†ÙŠÙ‡','Ø¯ÙˆÙ„Ø§Ø±','ÙŠÙˆØ±Ùˆ'];
    opt.classList.toggle('active', currencies[i]===curr);
  });
  
  // Ø­ÙØ¸ ÙÙŠ GitHub Gist
  saveToGist();
  
  // Re-render everything to show new currency
  renderProducts(getFilteredProducts());
  if(document.getElementById('cartSheet').classList.contains('on')) renderCart();
  if(document.getElementById('detailSheet').classList.contains('on') && lastDetail){
    const p = products.find(x=>x.id===lastDetail);
    if(p) updateDetailDisplay(p);
  }
  if(document.getElementById('checkoutSheet').classList.contains('on')) renderCheckoutSummary();
  if(document.getElementById('adminPage').classList.contains('active')) renderAdmin();
  
  toast(`âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø¥Ù„Ù‰ ${CURRENCIES[curr].name}`);
}

// ============================================================
// INIT
// ============================================================
async function init(){
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Gist Ø£Ùˆ LocalStorage
  await loadFromGist();
  
  renderCats();
  renderProducts(products);
  
  // Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙŠ Console
  console.log('%cğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªØ¬Ø±:', 'color: #40E0D0; font-weight: bold;');
  console.log(`Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${products.length}`);
  console.log(`Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©: ${bankAccounts.length}`);
  console.log(`Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${CURRENCIES[currentCurrency].name}`);
  console.log(`Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${gistEnabled ? 'â˜ï¸ GitHub Gist' : 'ğŸ’¾ LocalStorage'}`);
  
  // Ø¥Ø¶Ø§ÙØ© ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ (Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙ‚Ø·)
  if(gistEnabled && GIST_CONFIG.gistId !== 'YOUR_GIST_ID'){
    setInterval(async () => {
      console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...');
      const oldCount = products.length;
      await loadFromGist();
      const newCount = products.length;
      
      if(newCount !== oldCount){
        console.log('âœ¨ ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©!');
        renderCats();
        renderProducts(getFilteredProducts());
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        toast('âœ¨ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
      }
    }, 5 * 60 * 1000); // ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
    
    console.log('ğŸ”„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù‘Ù„ (ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚)');
  }
}

// ============================================================
// PAGES
// ============================================================
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.getElementById('bottomNav').style.display = id==='adminPage'?'none':'flex';
}
function goAdmin(){ showPage('adminPage'); renderAdmin(); }
function goStore(){ showPage('storePage'); renderProducts(products); renderCats(); }

// ============================================================
// NAVIGATION
// ============================================================
function navClick(type,btn){
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('on'));
  btn.classList.add('on');
  
  if(type==='home'){
    curCat='Ø§Ù„ÙƒÙ„';
    renderCats();
    filterProducts();
  } else if(type==='explore'){
    curCat='Ø§Ù„ÙƒÙ„';
    renderCats();
    filterProducts();
  } else if(type==='fav'){
    const favList = products.filter(p=>favs.has(p.id));
    renderProducts(favList);
  }
}

// ============================================================
// CATEGORIES
// ============================================================
function renderCats(){
  const cats=['Ø§Ù„ÙƒÙ„',...new Set(products.map(p=>p.cat))];
  document.getElementById('catsWrap').innerHTML=cats.map(c=>
    `<div class="cat ${c===curCat?'on':''}" onclick="selCat('${c}',this)">${c}</div>`
  ).join('');
}
function selCat(c,el){
  curCat=c;
  document.querySelectorAll('.cat').forEach(x=>x.classList.remove('on'));
  el.classList.add('on');
  filterProducts();
}

// ============================================================
// FILTER
// ============================================================
function getFilteredProducts(){
  const q=document.getElementById('searchInput').value.trim().toLowerCase();
  let f=products;
  if(curCat!=='Ø§Ù„ÙƒÙ„') f=f.filter(p=>p.cat===curCat);
  if(q) f=f.filter(p=>p.name.toLowerCase().includes(q)||p.cat.toLowerCase().includes(q));
  return f;
}

function filterProducts(){
  const q=document.getElementById('searchInput').value.trim();
  // SECRET ADMIN CODE
  if(q==='admin1234'){
    document.getElementById('searchInput').value='';
    goAdmin();
    return;
  }
  renderProducts(getFilteredProducts());
}

// ============================================================
// PRODUCTS
// ============================================================
function renderProducts(list){
  const g=document.getElementById('productsGrid');
  if(!list.length){
    g.innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:55px 20px;color:var(--dim);"><div style="font-size:38px;margin-bottom:8px;">ğŸ”</div><div style="font-size:14px;font-weight:600;">Ù„Ø§ Ù†ØªØ§Ø¦Ø¬ ÙˆØ¬Ø¯Øª</div></div>`;
    return;
  }
  const curr = getCurrencySymbol();
  g.innerHTML=list.map((p,i)=>{
    const disc=p.oldPrice?Math.round((1-p.price/p.oldPrice)*100):0;
    const mainImg = p.imgs && p.imgs.length > 0 ? p.imgs[0] : null;
    return`<div class="pcard" style="animation-delay:${i*.06}s" onclick="openDetail(${p.id})">
      <div class="pimg">
        ${mainImg ? `<img src="${mainImg}" alt="${p.name}"/>` : `<span class="ic">${p.icon}</span>`}
        ${disc?`<span class="disc-badge">-${disc}%</span>`:''}
        <button class="fav ${favs.has(p.id)?'on':''}" onclick="event.stopPropagation();toggleFav(${p.id},this)">
          <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        </button>
      </div>
      <div class="pinfo">
        <div class="pname">${p.name}</div>
        <div class="prat"><span class="stars">${'â˜…'.repeat(Math.round(p.rating))}${'â˜†'.repeat(5-Math.round(p.rating))}</span><span class="rnum">${p.rating} (${p.reviews})</span></div>
        <div class="prow">
          <div class="pgrp"><span class="price">${p.price} ${curr}</span>${p.oldPrice?`<span class="price-old">${p.oldPrice}</span>`:''}</div>
          <button class="add-btn" onclick="event.stopPropagation();addToCart(${p.id})"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
        </div>
      </div>
    </div>`;
  }).join('');
}

// ============================================================
// FAVORITES
// ============================================================
function toggleFav(id,btn){
  if(favs.has(id)){favs.delete(id);btn.classList.remove('on');}
  else{favs.add(id);btn.classList.add('on');}
}

// ============================================================
// CART
// ============================================================
function addToCart(id){
  const p=products.find(x=>x.id===id);
  if(!p) return;
  const ex=cart.find(c=>c.id===id);
  if(ex) ex.qty++;
  else cart.push({...p,qty:1});
  updateBadge();
  toast(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© "${p.name}" Ù„Ù„Ø³Ù„Ø©`);
}
function updateBadge(){
  const t=cart.reduce((s,c)=>s+c.qty,0);
  const b=document.getElementById('cartBadge');
  b.textContent=t;
  b.classList.toggle('on',t>0);
}
function openCart(){
  document.getElementById('cartOverlay').classList.add('on');
  document.getElementById('cartSheet').classList.add('on');
  renderCart();
}
function closeCart(){
  document.getElementById('cartOverlay').classList.remove('on');
  document.getElementById('cartSheet').classList.remove('on');
}
function renderCart(){
  const w=document.getElementById('cartItems');
  const f=document.getElementById('cartFooter');
  const curr = getCurrencySymbol();
  if(!cart.length){
    w.innerHTML=`<div class="cart-empty"><svg viewBox="0 0 24 24"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg><p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p><span>Ø£Ø¶Ù Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span></div>`;
    f.style.display='none'; return;
  }
  f.style.display='block';
  w.innerHTML=cart.map(it=>{
    const mainImg = it.imgs && it.imgs.length > 0 ? it.imgs[0] : null;
    return `<div class="citem">
      <div class="citem-ic">${mainImg ? `<img src="${mainImg}" alt="${it.name}"/>` : it.icon}</div>
      <div class="citem-d">
        <div class="citem-n">${it.name}</div>
        <div class="citem-p">${it.price} ${curr}</div>
      </div>
      <div class="qty">
        <button class="qty-b" onclick="changeQty(${it.id},-1)">-</button>
        <span class="qty-n">${it.qty}</span>
        <button class="qty-b" onclick="changeQty(${it.id},1)">+</button>
      </div>
    </div>`;
  }).join('');
  const total=cart.reduce((s,c)=>s+(c.price*c.qty),0);
  document.getElementById('cartTotal').textContent=`${total} ${curr}`;
}
function changeQty(id,delta){
  const it=cart.find(c=>c.id===id);
  if(!it) return;
  it.qty+=delta;
  if(it.qty<1) cart=cart.filter(c=>c.id!==id);
  updateBadge();
  renderCart();
}

// ============================================================
// DETAIL SHEET
// ============================================================
let lastDetail=null;
function openDetail(id){
  const p=products.find(x=>x.id===id);
  if(!p) return;
  lastDetail=id;
  currentViewImgIndex=0;
  
  updateDetailDisplay(p);
  
  document.getElementById('detAddBtn').onclick=()=>addToCart(id);
  document.getElementById('detailOverlay').classList.add('on');
  document.getElementById('detailSheet').classList.add('on');
}

function updateDetailDisplay(p){
  const curr = getCurrencySymbol();
  const scrollContainer = document.getElementById('detImgScroll');
  const imgNav = document.getElementById('imgNav');
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ø³ÙƒØ±ÙˆÙ„
  scrollContainer.scrollLeft = 0;
  currentViewImgIndex = 0;
  
  // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ù…Ø¹ Ø§Ù„Ø§Ø³ÙƒØ±ÙˆÙ„
  if(p.imgs && p.imgs.length > 0){
    scrollContainer.innerHTML = p.imgs.map((img, i) => 
      `<div class="det-img-slide" style="background:linear-gradient(135deg,#1e1e35,#252545);"><img src="${img}" alt="${p.name}" style="display:block;width:100%;height:100%;object-fit:cover;"/></div>`
    ).join('');
    
    // Navigation dots
    if(p.imgs.length > 1){
      imgNav.innerHTML = p.imgs.map((img, i) =>
        `<div class="img-dot ${i === 0 ? 'active' : ''}" onclick="scrollToImage(${i})"></div>`
      ).join('');
      imgNav.style.display = 'flex';
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø§Ø³ÙƒØ±ÙˆÙ„ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
      scrollContainer.onscroll = function(){
        const scrollLeft = scrollContainer.scrollLeft;
        const slideWidth = scrollContainer.offsetWidth;
        const newIndex = Math.round(scrollLeft / slideWidth);
        if(newIndex !== currentViewImgIndex && newIndex >= 0 && newIndex < p.imgs.length){
          currentViewImgIndex = newIndex;
          document.querySelectorAll('.img-dot').forEach((dot, i) => {
            dot.classList.toggle('active', i === newIndex);
          });
        }
      };
    } else {
      imgNav.style.display = 'none';
    }
  } else {
    // Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ØµÙˆØ±
    scrollContainer.innerHTML = `<div class="det-img-slide"><span class="ic">${p.icon}</span></div>`;
    imgNav.style.display = 'none';
  }
  
  document.getElementById('detName').textContent = p.name;
  document.getElementById('detRat').innerHTML = `<span class="stars">${'â˜…'.repeat(Math.round(p.rating))}${'â˜†'.repeat(5 - Math.round(p.rating))}</span><span class="rnum">${p.rating} (${p.reviews} Ù…Ø±Ø§Ø¬Ø¹Ø©)</span>`;
  document.getElementById('detDesc').textContent = p.desc;
  document.getElementById('detPrice').textContent = `${p.price} ${curr}`;
  document.getElementById('detPold').textContent = p.oldPrice ? `${p.oldPrice} ${curr}` : '';
  document.getElementById('detPold').style.display = p.oldPrice ? 'inline' : 'none';
}

function scrollToImage(index){
  const scrollContainer = document.getElementById('detImgScroll');
  const slideWidth = scrollContainer.offsetWidth;
  scrollContainer.scrollTo({
    left: slideWidth * index,
    behavior: 'smooth'
  });
  currentViewImgIndex = index;
}

function closeDetail(){
  document.getElementById('detailOverlay').classList.remove('on');
  document.getElementById('detailSheet').classList.remove('on');
}

// ============================================================
// CHECKOUT
// ============================================================
function openCheckout(){
  if(!cart.length){toast('âš ï¸ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');return;}
  closeCart();
  renderCheckoutSummary();
  updateBankInfoInCheckout();
  document.getElementById('checkoutOverlay').classList.add('on');
  document.getElementById('checkoutSheet').classList.add('on');
}

function updateBankInfoInCheckout(){
  if(!bankAccounts.length) {
    const bankBox = document.getElementById('bankBox');
    bankBox.innerHTML = '<p style="text-align:center;color:var(--dim);padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ù†ÙƒÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</p>';
    return;
  }
  
  const bankBox = document.getElementById('bankBox');
  
  let bankOptionsHTML = '<div class="bank-box-title">ğŸ¦ Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„</div>';
  
  // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙƒØ®ÙŠØ§Ø±Ø§Øª
  bankAccounts.forEach((acc, index) => {
    const isFirst = index === 0;
    const borderColor = isFirst ? 'var(--accent)' : 'var(--border)';
    const radioBg = isFirst ? 'var(--accent)' : 'transparent';
    const radioInner = isFirst ? '<div style="position:absolute;top:3px;left:3px;right:3px;bottom:3px;background:#fff;border-radius:50%;"></div>' : '';
    
    bankOptionsHTML += `
      <div class="bank-account-option ${isFirst ? 'selected' : ''}" onclick="selectBankAccount(${acc.id})" id="bankAcc_${acc.id}">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
          <div style="width:20px;height:20px;border-radius:50%;border:2px solid ${borderColor};background:${radioBg};position:relative;flex-shrink:0;">
            ${radioInner}
          </div>
          <div style="font-size:14px;font-weight:700;color:var(--text);">${acc.name}</div>
        </div>
        <div style="padding-right:30px;">
          <div style="font-size:12px;color:var(--dim);margin-bottom:4px;">ğŸ¦ ${acc.bank}</div>
          <div style="font-size:12px;color:var(--dim);margin-bottom:4px;">ğŸ’³ ${acc.accountNumber}</div>
          ${acc.iban ? `<div style="font-size:11px;color:var(--dim);">ğŸ“‹ ${acc.iban}</div>` : ''}
        </div>
      </div>
    `;
  });
  
  // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±
  const firstAccount = bankAccounts[0];
  bankOptionsHTML += `
    <div id="selectedBankDetails" style="background:rgba(64,224,208,.07);border:1px solid rgba(64,224,208,.25);border-radius:10px;padding:14px;margin-top:12px;">
      <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:10px;">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±</div>
      <div class="bank-row">
        <span class="bank-l">Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</span>
        <span class="bank-v">${firstAccount.name} <button class="copy-btn" onclick="copyText('${firstAccount.name.replace(/'/g, "\\'")}')"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></span>
      </div>
      <div class="bank-row">
        <span class="bank-l">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</span>
        <span class="bank-v">${firstAccount.accountNumber} <button class="copy-btn" onclick="copyText('${firstAccount.accountNumber.replace(/-/g, '')}')"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></span>
      </div>
      <div class="bank-row">
        <span class="bank-l">Ø§Ù„Ø¨Ù†Ùƒ</span>
        <span class="bank-v">${firstAccount.bank}</span>
      </div>
      ${firstAccount.iban ? `<div class="bank-row">
        <span class="bank-l">Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† (IBAN)</span>
        <span class="bank-v">${firstAccount.iban} <button class="copy-btn" onclick="copyText('${firstAccount.iban}')"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></span>
      </div>` : ''}
    </div>
    
    <div style="margin-top:12px;">
      <div class="sec-t" style="font-size:12px;margin-bottom:6px;">ğŸ“ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>
      <div class="upload-area" id="uploadArea" onclick="document.getElementById('uploadFile').click()">
        <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        <p>Ø§Ø¶ØºØ· Ù„Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØµÙˆØ±Ø©</p>
        <span>JPG, PNG</span>
        <div class="file-name" id="fileName">âˆ’</div>
        <input type="file" id="uploadFile" accept="image/*" onchange="onFileSelect(event)"/>
      </div>
    </div>
  `;
  
  bankBox.innerHTML = bankOptionsHTML;
  
  // Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±
  window.selectedBankAccountId = firstAccount.id;
}

// Ø¯Ø§Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ
function selectBankAccount(accountId){
  try {
    const account = bankAccounts.find(a => a.id === accountId);
    if(!account) {
      console.error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨:', accountId);
      toast('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø³Ø§Ø¨');
      return;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±
    window.selectedBankAccountId = accountId;
    
    // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    bankAccounts.forEach(acc => {
      const optElement = document.getElementById('bankAcc_' + acc.id);
      if(!optElement) {
        console.warn('Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯:', acc.id);
        return;
      }
      
      const isSelected = acc.id === accountId;
      
      // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„Ø¥Ø·Ø§Ø±
      optElement.style.borderColor = isSelected ? 'var(--accent)' : 'var(--border)';
      
      if(isSelected) {
        optElement.classList.add('selected');
      } else {
        optElement.classList.remove('selected');
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø¨ØªÙ†
      const radioContainer = optElement.querySelector('div:first-child > div:first-child');
      if(radioContainer) {
        radioContainer.style.borderColor = isSelected ? 'var(--accent)' : 'var(--border)';
        radioContainer.style.background = isSelected ? 'var(--accent)' : 'transparent';
        radioContainer.innerHTML = isSelected ? '<div style="position:absolute;top:3px;left:3px;right:3px;bottom:3px;background:#fff;border-radius:50%;"></div>' : '';
      }
    });
    
    // ØªØ­Ø¯ÙŠØ« ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    const detailsBox = document.getElementById('selectedBankDetails');
    if(!detailsBox) {
      console.error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„');
      return;
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ HTML ÙƒØ§Ù…Ù„Ø§Ù‹
    let detailsHTML = `
      <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:10px;">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±</div>
      <div class="bank-row">
        <span class="bank-l">Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</span>
        <span class="bank-v">${account.name} <button class="copy-btn" onclick="copyText('${account.name.replace(/'/g, "\\'")}')"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></span>
      </div>
      <div class="bank-row">
        <span class="bank-l">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</span>
        <span class="bank-v">${account.accountNumber} <button class="copy-btn" onclick="copyText('${account.accountNumber.replace(/-/g, '')}')"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></span>
      </div>
      <div class="bank-row">
        <span class="bank-l">Ø§Ù„Ø¨Ù†Ùƒ</span>
        <span class="bank-v">${account.bank}</span>
      </div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© IBAN Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯
    if(account.iban) {
      detailsHTML += `
        <div class="bank-row">
          <span class="bank-l">Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† (IBAN)</span>
          <span class="bank-v">${account.iban} <button class="copy-btn" onclick="copyText('${account.iban}')"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></span>
        </div>
      `;
    }
    
    detailsBox.innerHTML = detailsHTML;
    
    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù„Ù‰:', account.name);
  } catch(error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ selectBankAccount:', error);
    toast('âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø³Ø§Ø¨');
  }
}
function closeCheckout(){
  document.getElementById('checkoutOverlay').classList.remove('on');
  document.getElementById('checkoutSheet').classList.remove('on');
}
function renderCheckoutSummary(){
  const curr = getCurrencySymbol();
  const items=cart.map(it=>{
    const mainImg = it.imgs && it.imgs.length > 0 ? it.imgs[0] : null;
    return`<div class="cs-row">
      <span class="cs-l">${mainImg?`<img src="${mainImg}" style="width:24px;height:24px;border-radius:5px;object-fit:cover;vertical-align:middle;margin-left:6px;" alt=""/>`:it.icon} ${it.name} Ã— ${it.qty}</span>
      <span class="cs-v">${it.price*it.qty} ${curr}</span>
    </div>`;
  }).join('');
  const total=cart.reduce((s,c)=>s+(c.price*c.qty),0);
  document.getElementById('orderSummary').innerHTML=items+`<div class="cs-row cs-total"><span class="cs-l">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</span><span class="cs-v">${total} ${curr}</span></div>`;
}
function selectPay(type){
  selectedPay=type;
  document.getElementById('payCOD').classList.toggle('on',type==='cod');
  document.getElementById('payBank').classList.toggle('on',type==='bank');
  document.getElementById('bankBox').classList.toggle('show',type==='bank');
  
  // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¨Ù†ÙƒÙŠ
  if(type === 'bank'){
    updateBankInfoInCheckout();
  }
}
function copyText(txt){
  navigator.clipboard.writeText(txt).then(()=>toast('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ'));
}

let uploadedFile = null;
function onFileSelect(e){
  const f=e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    uploadedReceipt = ev.target.result;
    document.getElementById('uploadArea').classList.add('has-file');
    document.getElementById('fileName').textContent=f.name;
    document.querySelector('#uploadArea p').textContent='âœ… ØªÙ… Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØµÙˆØ±Ø©';
  };
  reader.readAsDataURL(f);
}

async function confirmOrder(){
  const name=document.getElementById('inpName').value.trim();
  const phone=document.getElementById('inpPhone').value.trim();
  const addr=document.getElementById('inpAddr').value.trim();
  
  if(!name||!phone||!addr){
    toast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
    return;
  }
  
  if(selectedPay==='bank' && !uploadedReceipt){
    toast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„');
    return;
  }
  
  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
  await sendToTelegram(name, phone, addr);
  
  // Show success
  closeCheckout();
  document.getElementById('successScreen').classList.add('on');
  
  // Clear cart
  cart=[];
  updateBadge();
  
  // Clear form
  document.getElementById('inpName').value='';
  document.getElementById('inpPhone').value='';
  document.getElementById('inpAddr').value='';
  uploadedReceipt = null;
  document.getElementById('uploadArea').classList.remove('has-file');
  document.querySelector('#uploadArea p').textContent='Ø§Ø¶ØºØ· Ù„Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØµÙˆØ±Ø©';
  document.getElementById('fileName').textContent='âˆ’';
  document.getElementById('uploadFile').value='';
}

async function sendToTelegram(name, phone, addr){
  const curr = getCurrencySymbol();
  const total = cart.reduce((s,c)=>s+(c.price*c.qty),0);
  
  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ù…Ø®ØªØ§Ø±
  let bankInfo = '';
  if(selectedPay === 'bank' && window.selectedBankAccountId){
    const selectedBank = bankAccounts.find(a => a.id === window.selectedBankAccountId);
    if(selectedBank){
      bankInfo = `\nğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ù…Ø®ØªØ§Ø±:\n`;
      bankInfo += `   â€¢ ${selectedBank.name}\n`;
      bankInfo += `   â€¢ ${selectedBank.bank}\n`;
      bankInfo += `   â€¢ ${selectedBank.accountNumber}\n`;
    }
  }
  
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
  let message = `ğŸ›ï¸ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±\n\n`;
  message += `ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}\n`;
  message += `ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\n`;
  message += `ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addr}\n`;
  message += `ğŸ’° Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${selectedPay==='cod'?'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…':'Ø­ÙˆØ§Ù„Ø© Ø¨Ù†ÙƒÙŠØ©'}\n`;
  message += `ğŸ’µ Ø§Ù„Ø¹Ù…Ù„Ø©: ${CURRENCIES[currentCurrency].name}${bankInfo}\n`;
  message += `\nğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:\n`;
  
  cart.forEach((it,i)=>{
    message += `${i+1}. ${it.name}\n`;
    message += `   Ø§Ù„Ø³Ø¹Ø±: ${it.price} ${curr} Ã— ${it.qty} = ${it.price*it.qty} ${curr}\n`;
  });
  
  message += `\nğŸ’¸ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${total} ${curr}`;
  
  // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø© Ø¹Ù† Ø§Ù„Ø¥ÙŠØµØ§Ù„
  if(selectedPay === 'bank' && uploadedReceipt){
    message += `\n\nğŸ“ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‚Ø§Ù… Ø¨Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„`;
  }
  
  try {
    console.log('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...');
    
    // Ø·Ø±ÙŠÙ‚Ø© 1: Ø§Ø³ØªØ®Ø¯Ø§Ù… Telegram WebApp API (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹)
    if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData){
      const tg = window.Telegram.WebApp;
      
      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¨ÙˆØª
      tg.sendData(JSON.stringify({
        type: 'order',
        name: name,
        phone: phone,
        address: addr,
        paymentMethod: selectedPay,
        currency: currentCurrency,
        items: cart.map(it => ({
          name: it.name,
          price: it.price,
          qty: it.qty,
          total: it.price * it.qty
        })),
        total: total,
        hasReceipt: selectedPay === 'bank' && uploadedReceipt !== null
      }));
      
      console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± Telegram WebApp');
      return true;
    }
    
    // Ø·Ø±ÙŠÙ‚Ø© 2: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±ÙŠÙ‚Ø© GET Ø§Ù„Ø¨Ø³ÙŠØ·Ø© Ø¹Ø¨Ø± Proxy (Ø£ÙƒØ«Ø± Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©)
    const apiUrl = `https://api.telegram.org/bot${APP_CONFIG.telegramBotToken}/sendMessage`;
    const params = new URLSearchParams({
      chat_id: APP_CONFIG.telegramAdminChatId,
      text: message,
      parse_mode: 'HTML'
    });
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… CORS proxy
    const proxyUrl = 'https://api.allorigins.win/get?url=';
    const fullUrl = proxyUrl + encodeURIComponent(apiUrl + '?' + params.toString());
    
    console.log('Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Proxy...');
    const response = await fetch(fullUrl);
    const data = await response.json();
    
    // ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
    let result;
    try {
      result = JSON.parse(data.contents);
    } catch(e) {
      result = data.contents;
    }
    
    console.log('Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', result);
    
    if(result && result.ok){
      console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­');
      
      // Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
      if(selectedPay === 'bank' && uploadedReceipt){
        console.log('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„...');
        console.log('%cğŸ“¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©', 'color: #40E0D0; font-weight: bold;');
        try {
          await sendReceiptImage();
        } catch(imgError) {
          console.warn('âš ï¸ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©:', imgError);
          console.log('%cğŸ’¡ Ù†ØµÙŠØ­Ø©: Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ± Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ:', 'color: orange; font-weight: bold;');
          console.log('1. Ø§Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø³ÙŠØ±ÙØ± (GitHub Pages / Netlify)');
          console.log('2. Ø§Ø±Ø¨Ø·Ù‡ Ø¨Ø§Ù„Ø¨ÙˆØª Ø¹Ø¨Ø± @BotFather');
          console.log('3. Ø§Ø³ØªØ®Ø¯Ù…Ù‡ ÙƒÙ€ Telegram Mini App');
          console.log('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
        }
      }
      
      return true;
    } else {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', result);
      throw new Error(result?.description || 'ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
    }
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨:', error);
    
    // Ø±Ø³Ø§Ù„Ø© Ø¨Ø¯ÙŠÙ„Ø©: Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­Ø§ÙØ¸Ø©
    const orderData = `
${message}
${selectedPay === 'bank' ? '\nğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠÙˆØ¬Ø¯ Ø¥ÙŠØµØ§Ù„ Ù…Ø±ÙÙ‚ (ÙŠÙ…ÙƒÙ† Ø­ÙØ¸Ù‡ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­)' : ''}
    `.trim();
    
    try {
      await navigator.clipboard.writeText(orderData);
      toast('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨. Ø£Ø±Ø³Ù„Ù‡Ø§ Ù„Ù„Ø£Ø¯Ù…Ù† ÙŠØ¯ÙˆÙŠØ§Ù‹');
      console.log('%cØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­Ø§ÙØ¸Ø©', 'color: orange; font-weight: bold;');
      console.log(orderData);
      return false;
    } catch(e) {
      console.log('%cØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨:', 'color: orange; font-weight: bold;');
      console.log(orderData);
      toast('âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. Ø±Ø§Ø¬Ø¹ Console Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      return false;
    }
  }
}

// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
async function sendReceiptImage(){
  if(!uploadedReceipt) return false;
  
  try {
    console.log('ğŸ“¸ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„...');
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ base64 Ù…Ù† data URL
    const base64Data = uploadedReceipt.split(',')[1];
    
    // Ø·Ø±ÙŠÙ‚Ø© 1: Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù„Ù‰ Ø®Ø¯Ù…Ø© Ø®Ø§Ø±Ø¬ÙŠØ© Ø«Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·
    try {
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… imgbb API Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ (Ù„Ø§ ÙŠØ­ØªØ§Ø¬ API key Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø³ÙŠØ·)
      const formData = new FormData();
      formData.append('image', base64Data);
      
      const uploadResponse = await fetch('https://api.imgbb.com/1/upload?key=d3622bcd63c2f5adc94ec009cf253bf5', {
        method: 'POST',
        body: formData
      });
      
      if(uploadResponse.ok){
        const uploadResult = await uploadResponse.json();
        if(uploadResult.success && uploadResult.data && uploadResult.data.url){
          const imageUrl = uploadResult.data.url;
          console.log('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­:', imageUrl);
          
          // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©
          const messageUrl = `https://api.telegram.org/bot${APP_CONFIG.telegramBotToken}/sendMessage`;
          const proxyUrl = 'https://api.allorigins.win/get?url=';
          
          const params = new URLSearchParams({
            chat_id: APP_CONFIG.telegramAdminChatId,
            text: `ğŸ“ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¨Ù†ÙƒÙŠ:\n${imageUrl}`,
            parse_mode: 'HTML'
          });
          
          const fullUrl = proxyUrl + encodeURIComponent(messageUrl + '?' + params.toString());
          await fetch(fullUrl);
          
          console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø£Ø¯Ù…Ù†');
          toast('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„');
          return true;
        }
      }
    } catch(uploadError) {
      console.log('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù„Ù‰ imgbbØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø¨Ø§Ø´Ø±Ø©...');
    }
    
    // Ø·Ø±ÙŠÙ‚Ø© 2: Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
    try {
      const mimeType = uploadedReceipt.split(',')[0].split(':')[1].split(';')[0];
      const byteCharacters = atob(base64Data);
      const byteNumbers = new Array(byteCharacters.length);
      for (let i = 0; i < byteCharacters.length; i++) {
        byteNumbers[i] = byteCharacters.charCodeAt(i);
      }
      const byteArray = new Uint8Array(byteNumbers);
      const blob = new Blob([byteArray], {type: mimeType});
      
      const formData = new FormData();
      formData.append('chat_id', APP_CONFIG.telegramAdminChatId);
      formData.append('photo', blob, 'receipt.jpg');
      formData.append('caption', 'ğŸ“ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¨Ù†ÙƒÙŠ');
      
      const photoUrl = `https://api.telegram.org/bot${APP_CONFIG.telegramBotToken}/sendPhoto`;
      
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
      const directResponse = await fetch(photoUrl, {
        method: 'POST',
        body: formData
      });
      
      if(directResponse.ok) {
        const result = await directResponse.json();
        if(result.ok) {
          console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­');
          toast('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„');
          return true;
        }
      }
    } catch(directError) {
      console.log('ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±');
    }
    
    // Ø·Ø±ÙŠÙ‚Ø© 3: Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙÙ‚Ø·
    const messageUrl = `https://api.telegram.org/bot${APP_CONFIG.telegramBotToken}/sendMessage`;
    const proxyUrl = 'https://api.allorigins.win/get?url=';
    
    const alertParams = new URLSearchParams({
      chat_id: APP_CONFIG.telegramAdminChatId,
      text: `âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‚Ø§Ù… Ø¨Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„ Ù„ÙƒÙ† ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.\n\nğŸ’¡ ÙŠØ±Ø¬Ù‰ Ø·Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø°ÙƒÙˆØ± ÙÙŠ Ø§Ù„Ø·Ù„Ø¨.`,
      parse_mode: 'HTML'
    });
    
    const fullAlertUrl = proxyUrl + encodeURIComponent(messageUrl + '?' + alertParams.toString());
    await fetch(fullAlertUrl);
    
    console.log('âš ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø¯Ù…Ù† Ø¹Ù† ÙˆØ¬ÙˆØ¯ ØµÙˆØ±Ø©');
    
    // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
    try {
      localStorage.setItem('receipt_' + Date.now(), uploadedReceipt);
      console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­');
    } catch(e) {}
    
    return false;
    
  } catch(error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©:', error);
    return false;
  }
}

function closeSuccess(){
  document.getElementById('successScreen').classList.remove('on');
}

// ============================================================
// ADMIN PANEL
// ============================================================
function renderAdmin(){
  const curr = getCurrencySymbol();
  // Stats
  const totalProducts = products.length;
  const totalValue = products.reduce((s,p)=>s+p.price,0);
  const avgRating = (products.reduce((s,p)=>s+p.rating,0)/products.length).toFixed(1);
  
  document.getElementById('adminStats').innerHTML=`
    <div class="stat-card"><div class="stat-n">${totalProducts}</div><div class="stat-l">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div></div>
    <div class="stat-card"><div class="stat-n">${totalValue} ${curr}</div><div class="stat-l">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div></div>
    <div class="stat-card"><div class="stat-n">${avgRating}â­</div><div class="stat-l">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div></div>
  `;
  
  // Products list
  document.getElementById('adminProducts').innerHTML=products.map(p=>{
    const mainImg = p.imgs && p.imgs.length > 0 ? p.imgs[0] : null;
    return`<div class="admin-pcard">
      <div class="admin-pic">${mainImg ? `<img src="${mainImg}" alt="${p.name}"/>` : p.icon}</div>
      <div class="admin-pd">
        <div class="admin-pn">${p.name}</div>
        <div class="admin-ps">${p.price} ${curr}</div>
        <div class="admin-pc">${p.cat} â€¢ ${p.reviews} Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
      </div>
      <div class="admin-acts">
        <button class="admin-ab edit" onclick="openProdModal(${p.id})"><svg viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
        <button class="admin-ab del" onclick="deleteProduct(${p.id})"><svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
      </div>
    </div>`;
  }).join('');
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
  if(document.getElementById('bankAccountsSection').style.display !== 'none'){
    renderBankAccounts();
  }
}

function openProdModal(id){
  const el=document.getElementById('prodModal');
  const editId=document.getElementById('editId');
  
  if(id){
    const p=products.find(x=>x.id===id);
    if(!p) return;
    editId.value=id;
    document.getElementById('modalTitle').textContent='âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
    document.getElementById('mpName').value=p.name;
    document.getElementById('mpCat').value=p.cat;
    document.getElementById('mpPrice').value=p.price;
    document.getElementById('mpOldPrice').value=p.oldPrice||'';
    document.getElementById('mpRating').value=p.rating;
    document.getElementById('mpReviews').value=p.reviews;
    document.getElementById('mpDesc').value=p.desc;
    currentProductImgs = p.imgs ? [...p.imgs] : [];
    renderIconPicker(p.icon);
  } else {
    editId.value='';
    document.getElementById('modalTitle').textContent='â• Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯';
    document.getElementById('mpName').value='';
    document.getElementById('mpCat').value='';
    document.getElementById('mpPrice').value='';
    document.getElementById('mpOldPrice').value='';
    document.getElementById('mpRating').value='';
    document.getElementById('mpReviews').value='';
    document.getElementById('mpDesc').value='';
    currentProductImgs = [];
    renderIconPicker('ğŸ“¦');
  }
  
  updateImgGrid();
  document.getElementById('modalOverlay').classList.add('on');
  el.classList.add('on');
}

function closeProdModal(){
  document.getElementById('modalOverlay').classList.remove('on');
  document.getElementById('prodModal').classList.remove('on');
}

// ============================================================
// IMAGE UPLOAD FOR PRODUCTS
// ============================================================
function selectImageSlot(index){
  if(currentProductImgs.length >= 5 && !currentProductImgs[index]){
    toast('âš ï¸ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5 ØµÙˆØ±');
    return;
  }
  selectedImgSlot = index;
  document.getElementById('prodImgFile').click();
}

function onProdImgSelect(e){
  const file = e.target.files[0];
  if(!file) return;
  
  const reader = new FileReader();
  reader.onload = function(ev){
    currentProductImgs[selectedImgSlot] = ev.target.result;
    updateImgGrid();
    toast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø©');
  };
  reader.readAsDataURL(file);
  e.target.value = '';
}

function removeImage(index){
  currentProductImgs[index] = null;
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± null Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
  currentProductImgs = currentProductImgs.filter(img => img !== null);
  updateImgGrid();
  toast('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©');
}

function updateImgGrid(){
  const slots = document.querySelectorAll('.img-slot');
  slots.forEach((slot, i) => {
    const img = currentProductImgs[i];
    if(img){
      slot.classList.add('has-img');
      slot.innerHTML = `<img src="${img}" alt="ØµÙˆØ±Ø© ${i+1}"/><span class="remove-ic" onclick="event.stopPropagation();removeImage(${i})">Ã—</span>`;
    } else {
      slot.classList.remove('has-img');
      slot.innerHTML = `<span class="add-ic">+</span><span class="remove-ic" onclick="event.stopPropagation();removeImage(${i})">Ã—</span>`;
    }
  });
}

// ============================================================
// ICON PICKER
// ============================================================
let selIcon='ğŸ“¦';
function renderIconPicker(selected){
  selIcon=selected||'ğŸ“¦';
  document.getElementById('iconPicker').innerHTML=ICONS.map(ic=>
    `<div class="icon-opt ${ic===selIcon?'on':''}" onclick="selIcon='${ic}';document.querySelectorAll('.icon-opt').forEach(x=>x.classList.remove('on'));event.target.classList.add('on');">${ic}</div>`
  ).join('');
}

function saveProduct(){
  const name=document.getElementById('mpName').value.trim();
  const cat=document.getElementById('mpCat').value.trim();
  const price=parseFloat(document.getElementById('mpPrice').value);
  const oldPrice=parseFloat(document.getElementById('mpOldPrice').value)||0;
  const rating=parseFloat(document.getElementById('mpRating').value)||4.0;
  const reviews=parseInt(document.getElementById('mpReviews').value)||0;
  const desc=document.getElementById('mpDesc').value.trim();
  const icon=selIcon;

  if(!name||!cat||!price){toast('âš ï¸ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙØ¦Ø© ÙˆØ§Ù„Ø³Ø¹Ø± Ø¥Ø¬Ø¨Ø§Ø±ÙŠ');return;}

  const editId=document.getElementById('editId').value;
  const imgs = currentProductImgs.filter(img => img !== null);
  
  if(editId){
    const idx=products.findIndex(p=>p.id==editId);
    if(idx>-1){
      products[idx]={id:parseInt(editId),name,cat,icon,price,oldPrice,rating,reviews,desc,imgs};
      toast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬');
    }
  } else {
    products.push({id:nextId++,name,cat,icon,price,oldPrice,rating,reviews,desc,imgs});
    toast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯');
  }
  
  // Ø­ÙØ¸ ÙÙŠ GitHub Gist
  saveToGist();
  
  closeProdModal();
  renderAdmin();
  renderCats();
  renderProducts(getFilteredProducts());
}

function deleteProduct(id){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
  products=products.filter(p=>p.id!==id);
  cart=cart.filter(c=>c.id!==id);
  updateBadge();
  
  // Ø­ÙØ¸ ÙÙŠ GitHub Gist
  saveToGist();
  renderAdmin();
  renderCats();
  renderProducts(getFilteredProducts());
  toast('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬');
}

// ============================================================
// BANK ACCOUNTS MANAGEMENT
// ============================================================
function toggleBankSection(){
  const section = document.getElementById('bankAccountsSection');
  const isVisible = section.style.display !== 'none';
  section.style.display = isVisible ? 'none' : 'block';
  if(!isVisible) renderBankAccounts();
}

function renderBankAccounts(){
  const list = document.getElementById('bankAccountsList');
  if(!bankAccounts.length){
    list.innerHTML = '<p style="text-align:center;color:var(--dim);font-size:12px;padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ù†ÙƒÙŠØ©</p>';
    return;
  }
  
  list.innerHTML = bankAccounts.map(acc => `
    <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:8px;">
      <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:6px;">
        <div style="flex:1;">
          <div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:4px;">${acc.name}</div>
          <div style="font-size:11px;color:var(--dim);margin-bottom:2px;">ğŸ¦ ${acc.bank}</div>
          <div style="font-size:11px;color:var(--dim);margin-bottom:2px;">ğŸ’³ ${acc.accountNumber}</div>
          ${acc.iban ? `<div style="font-size:11px;color:var(--dim);">ğŸ“‹ ${acc.iban}</div>` : ''}
        </div>
        <div style="display:flex;gap:4px;">
          <button onclick="openBankModal(${acc.id})" style="width:28px;height:28px;border-radius:6px;background:#20B2AA;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          </button>
          <button onclick="deleteBankAccount(${acc.id})" style="width:28px;height:28px;border-radius:6px;background:var(--danger);border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
          </button>
        </div>
      </div>
    </div>
  `).join('');
}

function openBankModal(id){
  const modal = document.getElementById('bankModal');
  const editId = document.getElementById('editBankId');
  
  if(id){
    const acc = bankAccounts.find(a => a.id === id);
    if(!acc) return;
    
    editId.value = id;
    document.getElementById('bankModalTitle').textContent = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ';
    document.getElementById('bankName').value = acc.name;
    document.getElementById('bankAccountNum').value = acc.accountNumber;
    document.getElementById('bankBankName').value = acc.bank;
    document.getElementById('bankIban').value = acc.iban || '';
  } else {
    editId.value = '';
    document.getElementById('bankModalTitle').textContent = 'ğŸ¦ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ø¬Ø¯ÙŠØ¯';
    document.getElementById('bankName').value = '';
    document.getElementById('bankAccountNum').value = '';
    document.getElementById('bankBankName').value = '';
    document.getElementById('bankIban').value = '';
  }
  
  document.getElementById('bankModalOverlay').classList.add('on');
  modal.classList.add('on');
}

function closeBankModal(){
  document.getElementById('bankModalOverlay').classList.remove('on');
  document.getElementById('bankModal').classList.remove('on');
}

function saveBankAccount(){
  const name = document.getElementById('bankName').value.trim();
  const accountNumber = document.getElementById('bankAccountNum').value.trim();
  const bank = document.getElementById('bankBankName').value.trim();
  const iban = document.getElementById('bankIban').value.trim();
  
  if(!name || !accountNumber || !bank){
    toast('âš ï¸ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø¨Ù†Ùƒ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ');
    return;
  }
  
  const editId = document.getElementById('editBankId').value;
  
  if(editId){
    const idx = bankAccounts.findIndex(a => a.id == editId);
    if(idx > -1){
      bankAccounts[idx] = {id: parseInt(editId), name, accountNumber, bank, iban, active: true};
      toast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ');
    }
  } else {
    bankAccounts.push({id: nextBankId++, name, accountNumber, bank, iban, active: true});
    toast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ø¬Ø¯ÙŠØ¯');
  }
  
  // Ø­ÙØ¸ ÙÙŠ GitHub Gist
  saveToGist();
  
  closeBankModal();
  renderBankAccounts();
  
  // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
  if(document.getElementById('checkoutSheet').classList.contains('on')){
    updateBankInfoInCheckout();
  }
}

function deleteBankAccount(id){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠØŸ')) return;
  bankAccounts = bankAccounts.filter(a => a.id !== id);
  renderBankAccounts();
  
  // Ø­ÙØ¸ ÙÙŠ GitHub Gist
  saveToGist();
  
  // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
  if(document.getElementById('checkoutSheet').classList.contains('on')){
    updateBankInfoInCheckout();
  }
  
  toast('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ');
}

// ============================================================
// TOAST
// ============================================================
function toast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.classList.add('on');
  setTimeout(()=>t.classList.remove('on'),2100);
}

// ============================================================
// TEST TELEGRAM
// ============================================================
async function testTelegram(){
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
  if(APP_CONFIG.telegramBotToken === 'YOUR_BOT_TOKEN_HERE'){
    toast('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙˆØ¶Ø¹ Bot Token Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø£ÙˆÙ„Ø§Ù‹ (Ø§Ù„Ø³Ø·Ø± 513)');
    console.error('âŒ Bot Token ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
    console.log('%cÙƒÙŠÙÙŠØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Bot Token:', 'color: #FFD700; font-weight: bold;');
    console.log('1. Ø§Ø¨Ø­Ø« Ø¹Ù† @BotFather ÙÙŠ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…');
    console.log('2. Ø£Ø±Ø³Ù„ /newbot ÙˆØ§ØªØ¨Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª');
    console.log('3. Ø§Ù†Ø³Ø® Ø§Ù„Ù€ Token ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯');
    return;
  }
  
  if(APP_CONFIG.telegramAdminChatId === 'YOUR_CHAT_ID_HERE'){
    toast('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙˆØ¶Ø¹ Chat ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø£ÙˆÙ„Ø§Ù‹ (Ø§Ù„Ø³Ø·Ø± 514)');
    console.error('âŒ Chat ID ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
    console.log('%cÙƒÙŠÙÙŠØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID:', 'color: #FFD700; font-weight: bold;');
    console.log('1. Ø§Ø¨Ø­Ø« Ø¹Ù† @userinfobot ÙÙŠ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…');
    console.log('2. Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
    console.log('3. Ø§Ù†Ø³Ø® Ø§Ù„Ù€ ID ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯');
    return;
  }
  
  const testMessage = `ğŸ§ª Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù…ØªØ¬Ø± Ø£ÙŠÙˆÙ†\n\nÙ‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.\n\nâœ… Ø¥Ø°Ø§ Ø±Ø£ÙŠØª Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ ÙØ¥Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… ØµØ­ÙŠØ­Ø©!`;
  
  try {
    console.log('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±...');
    console.log('Bot Token:', APP_CONFIG.telegramBotToken.substring(0, 20) + '...');
    console.log('Admin Chat ID:', APP_CONFIG.telegramAdminChatId);
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… HTTPS Proxy Ù„ØªØ¬Ø§ÙˆØ² CORS
    const proxyUrl = 'https://api.allorigins.win/raw?url=';
    const apiUrl = `https://api.telegram.org/bot${APP_CONFIG.telegramBotToken}/sendMessage`;
    
    const response = await fetch(proxyUrl + encodeURIComponent(apiUrl + '?chat_id=' + APP_CONFIG.telegramAdminChatId + '&text=' + encodeURIComponent(testMessage)));
    
    const result = await response.json();
    console.log('Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', result);
    
    if(result.ok){
      toast('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­! ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…');
      console.log('%câœ… Ø§Ù„Ù†Ø¬Ø§Ø­! ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…', 'color: #00e676; font-size: 14px; font-weight: bold;');
    } else {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', result);
      if(result.error_code === 401){
        toast('âŒ Ø®Ø·Ø£: ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª ØºÙŠØ± ØµØ­ÙŠØ­');
        console.error('âŒ Ø§Ù„Ù€ Token ØºÙŠØ± ØµØ­ÙŠØ­. ØªØ­Ù‚Ù‚ Ù…Ù† @BotFather');
      } else if(result.error_code === 400){
        toast('âŒ Ø®Ø·Ø£: Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨ (Chat ID) ØºÙŠØ± ØµØ­ÙŠØ­');
        console.error('âŒ Ø§Ù„Ù€ Chat ID ØºÙŠØ± ØµØ­ÙŠØ­. ØªØ­Ù‚Ù‚ Ù…Ù† @userinfobot');
      } else {
        toast('âŒ Ø®Ø·Ø£: ' + (result.description || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
        console.error('âŒ Ø®Ø·Ø£:', result.description);
      }
    }
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
    toast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
    console.log('%cØªÙ„Ù…ÙŠØ­: ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Bot Token Ùˆ Chat ID Ø§Ù„ØµØ­ÙŠØ­ÙŠÙ†', 'color: orange;');
  }
}

// ============================================================
// TELEGRAM WEBAPP
// ============================================================
(function(){
  if(window.Telegram&&window.Telegram.WebApp){
    const tg=window.Telegram.WebApp;
    tg.ready(); tg.expand();
    tg.BackButton.show();
    tg.BackButton.onClick(()=>{
      if(document.getElementById('detailSheet').classList.contains('on')) closeDetail();
      else if(document.getElementById('checkoutSheet').classList.contains('on')) closeCheckout();
      else if(document.getElementById('cartSheet').classList.contains('on')) closeCart();
      else if(document.getElementById('prodModal').classList.contains('on')) closeProdModal();
      else if(document.getElementById('adminPage').classList.contains('active')) goStore();
      else tg.BackButton.hide();
    });
  }
})();

// ============================================================
init();

// Ø±Ø³Ø§Ù„Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ù…Ø·ÙˆØ±
console.log('%cğŸ“± Ù…ØªØ¬Ø± Ø£ÙŠÙˆÙ† - Telegram Mini App', 'color: #40E0D0; font-size: 18px; font-weight: bold;');
console.log('%câš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', 'color: #20B2AA; font-size: 14px; font-weight: bold;');
console.log('Bot Token:', APP_CONFIG.telegramBotToken);
console.log('Admin Chat ID:', APP_CONFIG.telegramAdminChatId);
console.log('%cÙ„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Bot Token:', 'color: #FFD700; font-weight: bold;');
console.log('1. ØªØ­Ø¯Ø« Ù…Ø¹ @BotFather ÙÙŠ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…');
console.log('2. Ø£Ø±Ø³Ù„ /newbot ÙˆØ§ØªØ¨Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª');
console.log('3. Ø§Ù†Ø³Ø® Ø§Ù„Ù€ Token ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø³Ø·Ø± 510');
console.log('%cÙ„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID:', 'color: #FFD700; font-weight: bold;');
console.log('1. ØªØ­Ø¯Ø« Ù…Ø¹ @userinfobot ÙÙŠ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…');
console.log('2. Ø³ÙŠØ±Ø³Ù„ Ù„Ùƒ Ù…Ø¹Ø±ÙÙƒ (Chat ID)');
console.log('3. Ø§Ù†Ø³Ø®Ù‡ ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø³Ø·Ø± 511');
console.log('%c' + 'â”€'.repeat(50), 'color: #40E0D0;');
</script>
</body>
</html>
